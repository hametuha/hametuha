name: Auto PR from master to release branch

on:
  push:
    branches: [master]

jobs:
  pull-request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main

      - name: Create or Update Pull Request
        uses: repo-sync/pull-request@v2
        with:
          destination_branch: "release"
          pr_title: "ğŸš€ Deploy to Production: master â†’ release"
          pr_body: |
            ## ğŸš€ æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

            æœ€æ–°ã® master ãƒ–ãƒ©ãƒ³ãƒã‚’ release ãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸ã™ã‚‹PRã§ã™ã€‚

            ### âš ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ç¢ºèªäº‹é …
            - [ ] ãƒ†ã‚¹ãƒˆãŒå…¨ã¦æˆåŠŸã—ã¦ã„ã‚‹
            - [ ] ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ã‚‹
            - [ ] æœ¬ç•ªç’°å¢ƒã¸ã®å½±éŸ¿ã‚’ç¢ºèªæ¸ˆã¿

            ### ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
            1. ã“ã®PRã‚’ãƒãƒ¼ã‚¸
            2. ãƒªãƒªãƒ¼ã‚¹ãƒ‰ãƒ©ãƒ•ãƒˆãŒè‡ªå‹•ä½œæˆã•ã‚Œã‚‹
            3. ãƒªãƒªãƒ¼ã‚¹ã‚’å…¬é–‹ã™ã‚‹ã¨æœ¬ç•ªç’°å¢ƒã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

            ---
            *ã“ã®PRã¯ master ãƒ–ãƒ©ãƒ³ãƒã¸ã® push ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚*
          pr_label: "deploy"
          github_token: ${{ secrets.GITHUB_TOKEN }}

  vulnerability:
    name: Check Vulnerability
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main

      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/php@master
        with:
          args: --all-projects
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN_FUMIKITO }}
