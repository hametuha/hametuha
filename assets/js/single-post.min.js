Chart.defaults.global.responsive=!0,function(t){"use strict";Hametuha.views.Scroll=Backbone.View.extend({el:"#content-wrapper",events:{},tategaki:!1,ticker:null,slider:null,max:1e3,timer:0,toLast:!1,animating:!1,limit:null,initialize:function(){_.bindAll(this,"getSliderPosition","updateTicker","tickerHandler","scrollHandler","moveTo","finishAnimate","passedTime"),this.ticker=t('<span id="slider-ticker">0%</span>'),this.tategaki=Hametuha.isTategaki(),this.slider=t("#slider"),this.limit=t("#post-author");var e=0;this.slider.slider({max:this.max,min:0,step:1,value:this.getSliderPosition(e),slide:this.updateTicker,change:this.updateTicker,stop:this.tickerHandler}),this.slider.find(".ui-slider-handle").append(this.ticker),t(window).on("resize scroll load",this.scrollHandler);var a=new Date;this.timer=a.getTime()},passedTime:function(){var t=new Date;return Math.round((t.getTime()-this.timer)/1e3)},getSliderPosition:function(t){return this.tategaki?this.max-t:t},updateTicker:function(t,e){isNaN(e.value)||this.ticker.text(e.value/10+"%")},tickerHandler:function(t,e){this.moveTo(e.value/1e3)},moveTo:function(e){var a=(t(document).height()-t(window).height())*e;this.animating=!0,t("body, html").animate({scrollTop:a},"fast",this.finishAnimate)},finishAnimate:function(){this.animating=!1},scrollHandler:function(){var e=t(window).scrollTop(),a=t(document).height()-t(window).height(),i=Math.min(1,Math.max(0,e/a)),n=this.limit.offset().top+50;if(this.animating||this.slider.slider("value",parseInt(1e3*i,10)),!this.toLast&&n<e+t(window).height()&&t("#work-end-ranker").length){this.toLast=!0;var s=t("#work-end-ranker").attr("data-post");Hametuha.ga.hitEvent("read","complete",s),Hametuha.ga.hitEvent("read","passed",s,this.passedTime()),t("body").addClass("finish-reading")}}}),jQuery(document).ready(function(t){t(".work-content p").each(function(e,a){Hametuha.str.startYakumono(t(a).text())||t(a).hasClass("wp-caption-text")||t(a).addClass("indent")});var e="viewing-content",a=t("#viewing-content"),i=t("#footer-single");i.on("click","a",function(n){if(n.preventDefault(),t(this).hasClass("active"))t(this).removeClass("active"),a.attr("id",e).removeClass("show-nav");else{i.find("a").removeClass("active"),t(this).addClass("active");var s=t(this).attr("href").replace("#","");s.match(/reading-nav/)?a.attr("id",e).addClass("show-nav"):a.attr("id","viewing-"+s.replace("-wrapper","")).removeClass("show-nav")}}),t(".reset-viewer").click(function(t){t.preventDefault(),a.attr("id",e).removeClass("show-nav"),i.find("a").removeClass("active")}),new Hametuha.views.Scroll;var n=t("#single-radar"),s,r;n.length&&(Modernizr.canvas?(s=n.get(0).getContext("2d"),r=new Chart(s).Radar(postScore,{})):n.replaceWith('<p class="alert alert-danger">Canvasに対応していないため、ご利用の環境ではレーダーチャートを表示できません。</p>')),t(document).on("submit","#review-form",function(e){e.preventDefault();var a=t(this).find("input[type=submit]");a.button("loading"),t(this).ajaxSubmit({dataType:"json",success:function(t){a.button("reset"),t.error?Hametuha.alert(t.message,!0):(Hametuha.alert(t.message),a.button("complete"),t.guest&&setTimeout(function(){a.attr("disabled",!0)},50))},error:function(){Hametuha.alert("評価を送信できませんでした。",!0),a.button("reset")}})}),t(document).on("click",".star-rating i",function(){var e=parseInt(t(this).attr("data-value"),10);t(".star-rating i").each(function(a,i){parseInt(t(i).attr("data-value"),10)<=e?t(i).addClass("active"):t(i).removeClass("active")}),t(this).nextAll("input[type=hidden]").val(e)})})}(jQuery);