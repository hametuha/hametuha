Chart.defaults.global.responsive=!0,function($){"use strict";Hametuha.views.Scroll=Backbone.View.extend({el:"#content-wrapper",events:{},tategaki:!1,ticker:null,slider:null,max:1e3,timer:0,toLast:!1,animating:!1,limit:null,initialize:function(){_.bindAll(this,"getSliderPosition","updateTicker","tickerHandler","scrollHandler","moveTo","finishAnimate","passedTime"),this.ticker=$('<span id="slider-ticker">0%</span>'),this.tategaki=Hametuha.isTategaki(),this.slider=$("#slider"),this.limit=$("#post-author");var t=0;this.slider.slider({max:this.max,min:0,step:1,value:this.getSliderPosition(t),slide:this.updateTicker,change:this.updateTicker,stop:this.tickerHandler}),this.slider.find(".ui-slider-handle").append(this.ticker),$(window).on("resize scroll load",this.scrollHandler);var e=new Date;this.timer=e.getTime()},passedTime:function(){var t=new Date;return Math.round((t.getTime()-this.timer)/1e3)},getSliderPosition:function(t){return this.tategaki?this.max-t:t},updateTicker:function(t,e){isNaN(e.value)||this.ticker.text(e.value/10+"%")},tickerHandler:function(t,e){this.moveTo(e.value/1e3)},moveTo:function(t){var e=($(document).height()-$(window).height())*t;this.animating=!0,$("body, html").animate({scrollTop:e},"fast",this.finishAnimate)},finishAnimate:function(){this.animating=!1},scrollHandler:function(){var t=$(window).scrollTop(),e=$(document).height()-$(window).height(),a=Math.min(1,Math.max(0,t/e)),i=this.limit.offset().top+50;if(this.animating||this.slider.slider("value",parseInt(1e3*a,10)),!this.toLast&&i<t+$(window).height()&&$("#work-end-ranker").length){this.toLast=!0;var n=$("#work-end-ranker").attr("data-post");Hametuha.ga.hitEvent("read","complete",n),Hametuha.ga.hitEvent("read","passed",n,this.passedTime()),$("body").addClass("finish-reading")}}}),jQuery(document).ready(function($){$(".work-content p").each(function(t,e){Hametuha.str.startYakumono($(e).text())||$(e).hasClass("wp-caption-text")||$(e).addClass("indent")});var t="viewing-content",e=$("#viewing-content"),a=$("#footer-single");a.on("click","a",function(i){if(i.preventDefault(),$(this).hasClass("active"))$(this).removeClass("active"),e.attr("id",t).removeClass("show-nav");else{a.find("a").removeClass("active"),$(this).addClass("active");var n=$(this).attr("href").replace("#","");n.match(/reading-nav/)?e.attr("id",t).addClass("show-nav"):e.attr("id","viewing-"+n.replace("-wrapper","")).removeClass("show-nav")}}),$(".reset-viewer").click(function(i){i.preventDefault(),e.attr("id",t).removeClass("show-nav"),a.find("a").removeClass("active")}),new Hametuha.views.Scroll;var i=$("#single-radar"),n,s;i.length&&(Modernizr.canvas?(n=i.get(0).getContext("2d"),s=new Chart(n).Radar(postScore,{})):i.replaceWith('<p class="alert alert-danger">Canvasに対応していないため、ご利用の環境ではレーダーチャートを表示できません。</p>')),$(document).on("submit","#review-form",function(t){t.preventDefault();var e=$(this).find("input[type=submit]");e.button("loading"),$(this).ajaxSubmit({dataType:"json",success:function(t){e.button("reset"),t.error?Hametuha.alert(t.message,!0):(Hametuha.alert(t.message),e.button("complete"),t.guest&&setTimeout(function(){e.attr("disabled",!0)},50))},error:function(){Hametuha.alert("評価を送信できませんでした。",!0),e.button("reset")}})}),$(document).on("click",".star-rating i",function(){var t=parseInt($(this).attr("data-value"),10);$(".star-rating i").each(function(e,a){parseInt($(a).attr("data-value"),10)<=t?$(a).addClass("active"):$(a).removeClass("active")}),$(this).nextAll("input[type=hidden]").val(t)}),$(document).on("created.hametuha",".list-create-form",function(t,e){$("#list-changer").append('<div class="checkbox"><label><input type="checkbox" name="lists[]" value="'+e.ID+'" checked>'+("private"===e.post_status?"非公開: ":"公開　: ")+e.post_title+"</label></div>")})})}(jQuery);