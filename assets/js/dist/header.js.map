{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./assets/js/src/header.jsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","wp","element","Component","render","addQueryArgs","url","HametuHeader","props","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","state","assign","login_url","location","pathname","register","lastChecked","notifications","getStateValue","_this2","jQuery","on","setState","checkNotifications","setInterval","_this3","loggedIn","apiFetch","path","then","response","catch","e","Hametuha","alert","message","action","_wpnonce","CookieTasting","redirect_to","encodeURIComponent","window","logout","getLogoutUrl","isLoggedIn","avatar","userName","role","isAuthor","_this4","React","createElement","className","href","data-toggle","src","alt","data-last-checked","id","length","map","notification","dangerouslySetInnerHTML","__html","rendered","onClick","handleClick","_this5","preventDefault","link","currentTarget","classList","add","testBefore","finally","remove","document","getElementById"],"mappings":"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","file":"header.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/* global CookieTasting: false */\n\nconst {Component, render} = wp.element;\nconst { addQueryArgs } = wp.url;\n\nclass HametuHeaderEmpty extends Component {\n  render() {\n    return (\n      <li style={{display: 'none'}} />\n    )\n  }\n}\n\nclass HametuHeader extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = Object.assign( {\n      login_url: '/wp-login.php?redirect_to=' + location.pathname,\n      register: '/wp-login.php?action=register&redirect_to=' + location.pathname,\n      lastChecked: 0,\n      notifications: [],\n    }, this.getStateValue() );\n  }\n\n  componentDidMount() {\n    // Observe Cookie change.\n    jQuery( 'html' ).on( 'cookie.tasting.updated', () => {\n      this.setState( this.getStateValue() );\n    } );\n    // Check notifications.\n    this.checkNotifications();\n    setInterval( () => {\n      this.checkNotifications();\n    }, 1 * 60 * 1000 );\n  }\n\n  checkNotifications() {\n    // Only when user is logged in.\n    if ( ! this.state.loggedIn ) {\n      return;\n    }\n    // Retrieve notifications.\n    wp.apiFetch( {\n      path: 'hametuha/v1/notifications/recent',\n    } ).then( response => {\n      this.setState( { notifications: response } );\n    } ).catch( e => {\n      Hametuha.alert( e.message || 'エラーが発生しました。' );\n    } );\n  }\n\n  getLogoutUrl() {\n    return addQueryArgs( '/wp-login.php', {\n      action: 'logout',\n      _wpnonce: CookieTasting.get( 'logout' ),\n      redirect_to: encodeURIComponent( window.location.pathname ),\n    } );\n  }\n\n  getStateValue() {\n    return {\n      logout: this.getLogoutUrl(),\n      loggedIn: CookieTasting.isLoggedIn(),\n      avatar: CookieTasting.get( 'avatar' ) || '',\n      name: CookieTasting.userName(),\n      role: CookieTasting.get( 'role' ),\n      isAuthor: !! CookieTasting.get( 'is_author' ),\n    }\n  }\n\n  render() {\n    return (\n      <ul className=\"navbar-nav navbar-right navbar-login navbar-login--user nav nav-pills col-sm-1\">\n\n        {this.state.loggedIn ? (\n\n          <li className=\"dropdown\">\n            <a href=\"#\" className=\"dropdown-toggle\"\n               data-toggle=\"dropdown\">\n              <img className='avatar' src={this.state.avatar} alt={this.state.name} />\n            </a>\n            <ul className=\"dropdown-menu\">\n              <li className=\"greeting\">\n                <strong>{this.state.name}</strong>さん<br/>\n                <span className=\"role\">{this.state.role}</span>\n              </li>\n              <li className=\"divider\"/>\n              <li>\n                <a href=\"/dashboard\">\n                  <i className=\"icon-cog\"/>\n                  ダッシュボード\n                </a>\n              </li>\n\n\n              {this.state.isAuthor ? (\n                <li>\n                  <a href=\"/wp-admin/edit.php\">\n                    <i className=\"icon-dashboard\"/>\n                    作品管理\n                  </a>\n                </li>\n              ) : null }\n\n\n\n              <li className=\"divider\"/>\n              <li>\n                <a href=\"/your/comments/\">\n                  <i className=\"icon-bubble-dots\"/>\n                  あなたのコメント\n                </a>\n              </li>\n              <li>\n                <a href=\"/your/lists/\">\n                  <i className=\"icon-drawer3\"/>\n                  あなたのリスト\n                </a>\n              </li>\n              <li>\n                <a href=\"/your/reviews/\">\n                  <i className=\"icon-star2\"/>\n                  レビューした作品\n                </a>\n              </li>\n              <li>\n                <a href=\"/my/ideas/\">\n                  <i className=\"icon-lamp4\"/>\n                  アイデア帳\n                </a>\n              </li>\n              <li>\n                <a href=\"/doujin/follower/\">\n                  <i className=\"icon-heart5\"/>\n                  フォロワー\n                </a>\n              </li>\n\n              <li className=\"divider\"/>\n              <li>\n                <a href={this.state.logout}>\n                  <i className=\"icon-exit4\"/>\n                  ログアウト\n                </a>\n              </li>\n            </ul>\n          </li>\n        ) : null }\n\n\n\n        {this.state.loggedIn ? (\n          <li className=\"dropdown\">\n            <a href=\"#\" className=\"dropdown-toggle dropdown--notify\" data-toggle=\"dropdown\"\n               data-last-checked={this.state.lastChecked}>\n              <i className=\"icon-earth\"/>\n            </a>\n            <ul id=\"notification-container\" className=\"dropdown-menu notification__container\">\n              { this.state.notifications.length ? (\n                this.state.notifications.map( ( notification ) => {\n                  return (\n                    <li className='notification__item--header' dangerouslySetInnerHTML={{__html: notification.rendered}} />\n                  )\n                } )\n              ) : (\n                <li>\n                  <span>お知らせはなにもありません。</span>\n                </li>\n              )}\n              <li className=\"text-center notification__more\">\n                <a href=\"/dashboard/notifications/all\">\n                  通知一覧へ\n                  <i className=\"icon-arrow-right4\"/>\n                </a>\n              </li>\n            </ul>\n          </li>\n        ) : null }\n\n\n\n        { this.state.loggedIn ? null : (\n          <li className=\"login-buttons\">\n            <a href={this.state.login_url} onClick={(e) => { this.handleClick( e ) }}>ログイン</a>\n            <a href={this.state.register} onClick={(e) => { this.handleClick( e ) }}>登録</a>\n          </li>\n        )}\n\n      </ul>\n    );\n  }\n\n  /**\n   * Handle normal click\n   *\n   * @param {MouseEvent} e\n   */\n  handleClick( e ) {\n    e.preventDefault();\n    const link = e.currentTarget;\n    link.classList.add( 'disabled' );\n    CookieTasting.testBefore().then( () => {\n      this.setState( this.getStateValue() );\n    }).catch( () => {\n      window.location.href = link.href;\n    }).finally(() => {\n      link.classList.remove( 'disabled' );\n    });\n  }\n}\n\nrender(<HametuHeader/>, document.getElementById('user-info'));\n"],"sourceRoot":""}