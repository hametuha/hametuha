{"version":3,"sources":["components/event-participate.js"],"names":["angular","module","controller","$scope","$http","$timeout","participants","HamEvent","inList","limit","parseInt","text","loading","timer","saveStatus","status","callback","cancel","method","url","wpApiSettings","root","event","headers","X-WP-Nonce","nonce","data","then","response","message","Hametuha","alert","findIndex","id","i","l","length","getOut","index","splice","getIn","push","updateComment"],"mappings":"AAUAA,QAAQC,OAAO,YACZC,WAAY,iBAAkB,CAAE,SAAU,QAAS,WAAY,SAAUC,EAAQC,EAAOC,GAEvFF,EAAOG,aAAeC,SAASD,aAE/BH,EAAOK,OAASD,SAASC,OAEzBL,EAAOM,MAAQC,SAASH,SAASE,MAAO,IAExCN,EAAOQ,KAAOJ,SAASI,KAEvBR,EAAOS,SAAU,EAEjB,IAAIC,EAAQ,KAERC,EAAa,SAASC,EAAQJ,EAAMK,GACtC,IAAKb,EAAOS,QAOZ,OALWC,GACTR,EAASY,OAAOJ,GAECV,EAAOY,OAC1BZ,EAAOS,SAAU,EACVR,EAAM,CACXc,OAAQ,OACRC,IAAKC,cAAcC,KAAO,4BAA8Bd,SAASe,MAAQ,IACzEC,QAAS,CACPC,aAAcJ,cAAcK,OAE9BC,KAAM,CACJX,OAAQA,EACRJ,KAAMA,KAEPgB,KAAKX,EAAU,SAASY,GACzB,IAAIC,EAAUD,EAASF,KAAOE,EAASF,KAAKG,QAAU,yBACtDC,SAASC,MAAMF,GAAS,KACvBF,KAAK,WACNxB,EAAOS,SAAU,KAIjBoB,EAAY,SAASC,GACvB,IAAI,IAAIC,EAAI,EAAGC,EAAIhC,EAAOG,aAAa8B,OAAQF,EAAIC,EAAGD,IACpD,GAAID,IAAO9B,EAAOG,aAAa4B,GAAGD,GAChC,OAAOC,EAGX,OAAO,GAGT/B,EAAOkC,OAAS,WACdvB,GAAW,EAAOX,EAAOQ,KAAM,SAASiB,GACtC,IAAIU,EAAQN,EAAUJ,EAASF,KAAKO,KAC/B,IAAUK,IACbnC,EAAOG,aAAaiC,OAAOD,EAAO,GAClCnC,EAAOK,QAAS,MAKtBL,EAAOqC,MAAQ,WACb1B,GAAW,EAAMX,EAAOQ,KAAM,SAASiB,IAEhC,IADOI,EAAUJ,EAASF,KAAKO,MAElC9B,EAAOG,aAAamC,KAAKb,EAASF,MAClCvB,EAAOK,QAAS,MAKtBL,EAAOuC,cAAgB,WAChB7B,GACHR,EAASY,OAAQJ,GAEnBA,EAAQR,EAAU,WAChBS,EAAWX,EAAOK,OAAQL,EAAOQ,KAAM,eAGtC","file":"../../components/event-participate.js","sourcesContent":["/**\n * Description\n */\n\n/* global HamEvent: true*/\n/* global Hametuha: true*/\n/* global wpApiSettings: false */\n\n(function(){\n\nangular.module('hametuha')\n  .controller( 'hameventStatus', [ '$scope', '$http', '$timeout', function( $scope, $http, $timeout ){\n\n    $scope.participants = HamEvent.participants;\n\n    $scope.inList = HamEvent.inList;\n\n    $scope.limit = parseInt(HamEvent.limit, 10);\n\n    $scope.text = HamEvent.text;\n\n    $scope.loading = false;\n\n    var timer = null;\n\n    var saveStatus = function(status, text, callback){\n      if ( $scope.loading ) {\n        return;\n      } else if (timer) {\n        $timeout.cancel(timer);\n      }\n      var oldStatus = !! $scope.status;\n      $scope.loading = true;\n      return $http({\n        method: 'POST',\n        url: wpApiSettings.root + 'hametuha/v1/participants/' + HamEvent.event + '/',\n        headers: {\n          'X-WP-Nonce': wpApiSettings.nonce\n        },\n        data: {\n          status: status,\n          text: text\n        }\n      }).then(callback, function(response){\n        var message = response.data ? response.data.message : 'エラーが発生しました。やりなおしてください。';\n        Hametuha.alert(message, true);\n      }).then(function(){\n        $scope.loading = false;\n      });\n    };\n\n    var findIndex = function(id){\n      for(var i = 0, l = $scope.participants.length; i < l; i++){\n        if( id === $scope.participants[i].id ){\n          return i;\n        }\n      }\n      return false;\n    };\n\n    $scope.getOut = function(){\n      saveStatus(false, $scope.text, function(response){\n        var index = findIndex(response.data.id);\n        if ( false !== index ) {\n          $scope.participants.splice(index, 1);\n          $scope.inList = false;\n        }\n      });\n    };\n\n    $scope.getIn = function(){\n      saveStatus(true, $scope.text, function(response){\n        var index = findIndex(response.data.id);\n        if ( false === index ) {\n          $scope.participants.push(response.data);\n          $scope.inList = true;\n        }\n      });\n    };\n\n    $scope.updateComment = function(){\n      if ( timer ) {\n        $timeout.cancel( timer );\n      }\n      timer = $timeout( function(){\n        saveStatus($scope.inList, $scope.text, function(){\n          // Do nothing.\n        });\n      }, 3000 );\n    };\n\n\n  }]);\n\n})();\n"]}