{"version":3,"sources":["components/login-change-helper.js"],"names":["$","document","ready","form","input","container","parents","submit","find","length","timer","checkLogin","callback","clearTimeout","setTimeout","addClass","removeClass","ajax","attr","type","dataType","data","login","val","_wpnonce","success","result","niceName","prop","error","complete","keyup","e","this","blur","preventDefault","window","confirm","ajaxSubmit","Hametuha","alert","message","location","href","url","$checked","jQuery"],"mappings":";;;CAMA,SAAWA,GACP,YAEAA,GAAEC,UAAUC,MAAM,WACd,GAAIC,GAAOH,EAAE,sBACTI,EAAQJ,EAAE,eACVK,EAAYD,EAAME,QAAQ,iBAC1BC,EAASJ,EAAKK,KAAK,qBAEvB,IAAIL,EAAKM,OAAQ,CACb,GAAIC,GAAQ,KACRC,EAAa,SAASC,GAEdF,GACAG,aAAaH,GAEjBA,EAAQI,WAAW,WACfT,EAAUU,SAAS,WACnBV,EAAUW,YAAY,eAAeA,YAAY,aACjDhB,EAAEiB,KAAKb,EAAMc,KAAK,eACdC,KAAM,MACNC,SAAU,OACVC,MACIC,MAAOlB,EAAMmB,MACbC,SAAUrB,EAAKK,KAAK,wBAAwBe,OAEhDE,QAAS,SAASC,GACVA,EAAOD,SACPpB,EAAUU,SAAS,eACnBf,EAAE,mBAAmBuB,IAAIG,EAAOC,UAChCpB,EAAOqB,KAAK,YAAY,GACpBhB,GACAA,MAGJP,EAAUU,SAAS,aACnBR,EAAOqB,KAAK,YAAY,KAGhCC,MAAO,SAASA,GACZxB,EAAUU,SAAS,aACnBR,EAAOqB,KAAK,YAAY,IAE5BE,SAAU,WACNzB,EAAUW,YAAY,eAG/B,MAIXZ,GAAM2B,MAAM,SAASC,GACbhC,EAAEiC,MAAMV,MAAMd,QACdE,MAIRP,EAAM8B,KAAK,SAASF,GACZhC,EAAEiC,MAAMV,MAAMd,QACdE,MAKRR,EAAKI,OAAO,SAASyB,GACjBA,EAAEG,iBACE/B,EAAMmB,MAAMd,QAAU2B,OAAOC,QAAQ,yBACrC1B,EAAW,WACPR,EAAKmC,YACDlB,SAAU,OACVK,QAAS,SAASC,GACda,SAASC,MAAMd,EAAOe,SAAS,GAC/B3B,WAAW,WACPsB,OAAOM,SAASC,KAAOjB,EAAOkB,KAC/B,MAEPf,MAAO,WACHU,SAASC,MAAM,4BAA4B,UAUnExC,EAAE,8CAA8CO,OAAO,SAASyB,GAC5D,GAAIa,GAAW7C,EAAE,gBAAiB,iBAC7B6C,GAASpC,OAIVT,EAAEiC,MAAMzB,KAAK,yBAAyBe,IAAIsB,EAAStB,QAHnDS,EAAEG,iBACFI,SAASC,MAAM,uBAQ5BM","file":"../../components/login-change-helper.js","sourcesContent":["/**\n * Description\n */\n\n/*global Hametuha: true*/\n\n(function ($) {\n    'use strict';\n\n    $(document).ready(function(){\n        var form = $('#change-login-form'),\n            input = $('#login_name'),\n            container = input.parents('.has-feedback'),\n            submit = form.find('input[type=submit]');\n\n        if( form.length ){\n            var timer = null,\n                checkLogin = function(callback){\n                    // リセットする\n                    if( timer ){\n                        clearTimeout(timer);\n                    }\n                    timer = setTimeout(function(){\n                        container.addClass('loading');\n                        container.removeClass('has-success').removeClass('has-error');\n                        $.ajax(input.attr('data-check'), {\n                            type: 'GET',\n                            dataType: 'json',\n                            data: {\n                                login: input.val(),\n                                _wpnonce: form.find('input[name=_wpnonce]').val()\n                            },\n                            success: function(result){\n                                if( result.success ){\n                                    container.addClass('has-success');\n                                    $('#login_nicename').val(result.niceName);\n                                    submit.prop('disabled', false);\n                                    if( callback ){\n                                        callback();\n                                    }\n                                }else{\n                                    container.addClass('has-error');\n                                    submit.prop('disabled', true);\n                                }\n                            },\n                            error: function(error){\n                                container.addClass('has-error');\n                                submit.prop('disabled', true);\n                            },\n                            complete: function(){\n                                container.removeClass('loading');\n                            }\n                        });\n                    }, 1500);\n                };\n\n            // キータイプで検索\n            input.keyup(function(e){\n                if( $(this).val().length ){\n                    checkLogin();\n                }\n            });\n            // フォーカスが外れたら検索\n            input.blur(function(e){\n                if( $(this).val().length ){\n                    checkLogin();\n                }\n            });\n\n            // 送信\n            form.submit(function(e){\n                e.preventDefault();\n                if( input.val().length && window.confirm('ログイン名を変更します。よろしいですか？') ){\n                    checkLogin(function(){\n                        form.ajaxSubmit({\n                            dataType: 'json',\n                            success: function(result){\n                                Hametuha.alert(result.message, false);\n                                setTimeout(function(){\n                                    window.location.href = result.url;\n                                }, 5000);\n                            },\n                            error: function(){\n                                Hametuha.alert('更新に失敗しました。もう一度やり直してください。', true);\n                            }\n                        });\n                    });\n                }\n            });\n        }\n\n\n        // プロフィール写真変更フォーム\n        $('#select-picture-form, #delete-picture-form').submit(function(e){\n            var $checked = $('input:checked', '#pic-file-list');\n            if( !$checked.length ){\n                e.preventDefault();\n                Hametuha.alert('画像が選択されていません。');\n            }else{\n                $(this).find('.attachment_id_holder').val($checked.val());\n            }\n        });\n\n    });\n\n})(jQuery);\n"]}