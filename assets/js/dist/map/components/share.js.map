{"version":3,"sources":["components/share.js"],"names":["$","angular","module","controller","$scope","$element","selection","selectionTop","contentHeight","updateText","window","getSelection","toString","offsetHeight","type","rect","getRangeAt","cloneRange","getBoundingClientRect","top","offsetTop","directive","$http","restrict","replace","scope","id","templateUrl","Hametuha","template","link","$elem","attr","styleTop","display","$watch","newValue","oldValue","length","document","body","scrollTop","share","text","alert","method","url","wpApiSettings","root","headers","X-WP-Nonce","nonce","data","then","response","message","jQuery"],"mappings":"CAMA,SAAWA,GACP,aACAC,QAAQC,OAAO,YACZC,WAAW,cAAe,CAAC,SAAU,WAAY,SAASC,EAAQC,GAEjED,EAAOE,UAAY,GAEnBF,EAAOG,aAAe,EAEtBH,EAAOI,cAAgB,EAEvBJ,EAAOK,WAAa,WAClB,IAAIH,EAAYI,OAAOC,eAGvB,GAFAP,EAAOE,UAAYA,EAAUM,WAC7BR,EAAOI,cAAgBH,EAAS,GAAGQ,aAC9B,UAAYP,EAAUQ,KAAO,CAChC,IACIC,EADQT,EAAUU,WAAW,GAAGC,aACnBC,wBACjBd,EAAOG,aAAeQ,EAAKI,IAAMd,EAAS,GAAGe,UAAY,QAEzDhB,EAAOG,aAAe,MAI3Bc,UAAU,aAAc,CAAE,QAAS,SAAUC,GAI5C,MAAO,CACLC,SAAa,IACbC,SAAa,EACbC,MAAa,CACXnB,UAAY,IACZC,aAAc,IACdC,cAAe,IACfkB,GAAI,KAENC,YAAaC,SAASC,SAAS,oBAC/BC,KAAa,SAAU1B,EAAQ2B,EAAOC,GAEpC5B,EAAO6B,SAAW,EAElB7B,EAAO8B,QAAU,OAEjB9B,EAAO+B,OAAO,YAAa,SAASC,EAAUC,GACvCD,EAASE,QACZlC,EAAO6B,SAAa7B,EAAOG,aAAegC,SAASC,KAAKC,UAAc,KACtErC,EAAO8B,QAAU,SAEjB9B,EAAO8B,QAAU,SAIrB9B,EAAOsC,MAAQ,WACb,GAAOtC,EAAOE,UAAUgC,OAAxB,CAIA,IAAIK,EAAOvC,EAAOE,UAAY,GAG9B,OAFAF,EAAOE,UAAY,GACnBsB,SAASgB,MAAM,gBACRtB,EAAM,CACXuB,OAAQ,OACRC,IAAKC,cAAcC,KAAO,uBAAyB5C,EAAOsB,GAAK,IAC/DuB,QAAS,CACPC,aAAcH,cAAcI,OAE9BC,KAAM,CACJ1B,GAAItB,EAAOsB,GACXiB,KAAMA,KAEPU,KACD,SAASC,GACP1B,SAASgB,MAAOU,EAASF,KAAKG,UAEhC,SAASD,GACP,IAAIC,EAAUD,EAASF,KAAOE,EAASF,KAAKG,QAAU,yBACtD3B,SAASgB,MAAMW,GAAS,KACvBF,KAAK,WACNjD,EAAOE,UAAY,YA/ErC,CAuFGkD","file":"../../components/share.js","sourcesContent":["/**\n * Description\n */\n\n/*global Hametuha: true*/\n\n(function ($) {\n    'use strict';\n    angular.module('hametuha')\n      .controller('workContent', ['$scope', '$element', function($scope, $element){\n\n        $scope.selection = '';\n\n        $scope.selectionTop = 0;\n\n        $scope.contentHeight = 0;\n\n        $scope.updateText = function() {\n          var selection = window.getSelection();\n          $scope.selection = selection.toString();\n          $scope.contentHeight = $element[0].offsetHeight;\n          if ( 'Range' === selection.type ) {\n            var range = selection.getRangeAt(0).cloneRange();\n            var rect = range.getBoundingClientRect();\n            $scope.selectionTop = rect.top - $element[0].offsetTop - 50;\n          } else {\n            $scope.selectionTop = 0;\n          }\n        }\n      }])\n      .directive('textHolder', [ '$http', function ($http) {\n\n        'use strict';\n\n        return {\n          restrict   : 'E',\n          replace    : true,\n          scope      : {\n            selection : '=',\n            selectionTop: '=',\n            contentHeight: '=',\n            id: '@'\n          },\n          templateUrl: Hametuha.template('text-holder.html'),\n          link       : function ($scope, $elem, attr) {\n\n            $scope.styleTop = 0;\n\n            $scope.display = 'none';\n\n            $scope.$watch('selection', function(newValue, oldValue){\n              if ( newValue.length ) {\n                $scope.styleTop = ( $scope.selectionTop + document.body.scrollTop ) + 'px';\n                $scope.display = 'block';\n              } else {\n                $scope.display = 'none';\n              }\n            });\n\n            $scope.share = function(){\n              if ( ! $scope.selection.length ) {\n                return;\n              }\n              // Copy text and share\n              var text = $scope.selection + '';\n              $scope.selection = '';\n              Hametuha.alert('リクエストしています……');\n              return $http({\n                method: 'POST',\n                url: wpApiSettings.root + 'hametuha/v1/text/of/' + $scope.id + '/',\n                headers: {\n                  'X-WP-Nonce': wpApiSettings.nonce\n                },\n                data: {\n                  id: $scope.id,\n                  text: text\n                }\n              }).then(\n                function(response){\n                  Hametuha.alert( response.data.message )\n                },\n                function(response){\n                  var message = response.data ? response.data.message : 'エラーが発生しました。やりなおしてください。';\n                  Hametuha.alert(message, true);\n                }).then(function(){\n                  $scope.selection = '';\n                }\n              );\n            };\n\n          }\n        };\n      }]);\n})(jQuery);\n"]}