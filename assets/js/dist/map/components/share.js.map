{"version":3,"sources":["components/share.js"],"names":["$","angular","module","controller","$scope","$element","selection","selectionTop","contentHeight","updateText","window","getSelection","toString","offsetHeight","type","range","getRangeAt","cloneRange","rect","getBoundingClientRect","top","offsetTop","directive","$http","restrict","replace","scope","id","templateUrl","Hametuha","template","link","$elem","attr","styleTop","display","$watch","newValue","oldValue","length","document","body","scrollTop","share","text","alert","method","url","wpApiSettings","root","headers","X-WP-Nonce","nonce","data","then","response","message","jQuery"],"mappings":"CAMA,SAAWA,GACP,YACAC,SAAQC,OAAO,YACZC,WAAW,eAAgB,SAAU,WAAY,SAASC,EAAQC,GAEjED,EAAOE,UAAY,GAEnBF,EAAOG,aAAe,EAEtBH,EAAOI,cAAgB,EAEvBJ,EAAOK,WAAa,WAClB,GAAIH,GAAYI,OAAOC,cAGvB,IAFAP,EAAOE,UAAYA,EAAUM,WAC7BR,EAAOI,cAAgBH,EAAS,GAAGQ,aAC9B,UAAYP,EAAUQ,KAAO,CAChC,GAAIC,GAAQT,EAAUU,WAAW,GAAGC,aAChCC,EAAOH,EAAMI,uBACjBf,GAAOG,aAAeW,EAAKE,IAAMf,EAAS,GAAGgB,UAAY,OAEzDjB,GAAOG,aAAe,MAI3Be,UAAU,cAAgB,QAAS,SAAUC,GAI5C,OACEC,SAAa,IACbC,SAAa,EACbC,OACEpB,UAAY,IACZC,aAAc,IACdC,cAAe,IACfmB,GAAI,KAENC,YAAaC,SAASC,SAAS,oBAC/BC,KAAa,SAAU3B,EAAQ4B,EAAOC,GAEpC7B,EAAO8B,SAAW,EAElB9B,EAAO+B,QAAU,OAEjB/B,EAAOgC,OAAO,YAAa,SAASC,EAAUC,GACvCD,EAASE,QACZnC,EAAO8B,SAAa9B,EAAOG,aAAeiC,SAASC,KAAKC,UAAc,KACtEtC,EAAO+B,QAAU,SAEjB/B,EAAO+B,QAAU,SAIrB/B,EAAOuC,MAAQ,WACb,GAAOvC,EAAOE,UAAUiC,OAAxB,CAIA,GAAIK,GAAOxC,EAAOE,UAAY,EAG9B,OAFAF,GAAOE,UAAY,GACnBuB,SAASgB,MAAM,gBACRtB,GACLuB,OAAQ,OACRC,IAAKC,cAAcC,KAAO,uBAAyB7C,EAAOuB,GAAK,IAC/DuB,SACEC,aAAcH,cAAcI,OAE9BC,MACE1B,GAAIvB,EAAOuB,GACXiB,KAAMA,KAEPU,KACD,SAASC,GACP1B,SAASgB,MAAOU,EAASF,KAAKG,UAEhC,SAASD,GACP,GAAIC,GAAUD,EAASF,KAAOE,EAASF,KAAKG,QAAU,wBACtD3B,UAASgB,MAAMW,GAAS,KACvBF,KAAK,WACNlD,EAAOE,UAAY,aAQlCmD","file":"../../components/share.js","sourcesContent":["/**\n * Description\n */\n\n/*global Hametuha: true*/\n\n(function ($) {\n    'use strict';\n    angular.module('hametuha')\n      .controller('workContent', ['$scope', '$element', function($scope, $element){\n\n        $scope.selection = '';\n\n        $scope.selectionTop = 0;\n\n        $scope.contentHeight = 0;\n\n        $scope.updateText = function() {\n          var selection = window.getSelection();\n          $scope.selection = selection.toString();\n          $scope.contentHeight = $element[0].offsetHeight;\n          if ( 'Range' === selection.type ) {\n            var range = selection.getRangeAt(0).cloneRange();\n            var rect = range.getBoundingClientRect();\n            $scope.selectionTop = rect.top - $element[0].offsetTop - 50;\n          } else {\n            $scope.selectionTop = 0;\n          }\n        }\n      }])\n      .directive('textHolder', [ '$http', function ($http) {\n\n        'use strict';\n\n        return {\n          restrict   : 'E',\n          replace    : true,\n          scope      : {\n            selection : '=',\n            selectionTop: '=',\n            contentHeight: '=',\n            id: '@'\n          },\n          templateUrl: Hametuha.template('text-holder.html'),\n          link       : function ($scope, $elem, attr) {\n\n            $scope.styleTop = 0;\n\n            $scope.display = 'none';\n\n            $scope.$watch('selection', function(newValue, oldValue){\n              if ( newValue.length ) {\n                $scope.styleTop = ( $scope.selectionTop + document.body.scrollTop ) + 'px';\n                $scope.display = 'block';\n              } else {\n                $scope.display = 'none';\n              }\n            });\n\n            $scope.share = function(){\n              if ( ! $scope.selection.length ) {\n                return;\n              }\n              // Copy text and share\n              var text = $scope.selection + '';\n              $scope.selection = '';\n              Hametuha.alert('リクエストしています……');\n              return $http({\n                method: 'POST',\n                url: wpApiSettings.root + 'hametuha/v1/text/of/' + $scope.id + '/',\n                headers: {\n                  'X-WP-Nonce': wpApiSettings.nonce\n                },\n                data: {\n                  id: $scope.id,\n                  text: text\n                }\n              }).then(\n                function(response){\n                  Hametuha.alert( response.data.message )\n                },\n                function(response){\n                  var message = response.data ? response.data.message : 'エラーが発生しました。やりなおしてください。';\n                  Hametuha.alert(message, true);\n                }).then(function(){\n                  $scope.selection = '';\n                }\n              );\n            };\n\n          }\n        };\n      }]);\n})(jQuery);\n"]}