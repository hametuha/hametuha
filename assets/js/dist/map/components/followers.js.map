{"version":3,"sources":["components/followers.js"],"names":["angular","module","controller","$scope","$http","endpoint","WP_API_Settings","root","tabs","active","init","detectTab","hash","document","location","initFollowers","index","getFollowings","getFollowers","followers","followersOffset","followersTotal","followersMore","offset","method","url","headers","X-WP-Nonce","nonce","params","then","result","data","total","users","length","forEach","user","push","Hametuha","alert","nextFollowers","followings","followingOffset","followingTotal","followingMore","removeFollowing","id","confirm","indexToRemove","i","l","ID","success","splice"],"mappings":"AAOAA,QAAQC,OAAO,kBAAmB,iBAC7BC,WAAW,YAAa,SAAU,QAAS,SAAUC,EAAQC,GAE1D,GAAIC,GAAWC,gBAAgBC,KAAO,qBAEtCJ,GAAOK,OAECC,QAAQ,EACRC,MAAQ,IAGRD,QAAQ,EACRC,MAAQ,IAKhBP,EAAOQ,UAAY,WACf,GAAIC,GAAOC,SAASC,SAASF,IAC7B,QAAQA,GACJ,IAAK,aACDT,EAAOK,KAAK,GAAGC,QAAS,CACxB,MACJ,SACIN,EAAOK,KAAK,GAAGC,QAAS,IAOpCN,EAAOY,cAAgB,SAAUC,GAC7B,IAAKb,EAAOK,KAAKQ,GAAON,KAAM,CAC1B,OAAQM,GACJ,IAAK,GACDb,EAAOc,cAAc,EACrB,MACJ,SACId,EAAOe,aAAa,GAG5Bf,EAAOK,KAAKQ,GAAON,MAAO,IAKlCP,EAAOgB,aACPhB,EAAOiB,gBAAkB,EACzBjB,EAAOkB,eAAiB,EACxBlB,EAAOmB,eAAgB,EAGvBnB,EAAOe,aAAe,SAAUK,GAC5BnB,GACIoB,OAAS,MACTC,IAAQpB,EAAW,gBACnBqB,SACIC,aAAcrB,gBAAgBsB,OAElCC,QACIN,OAAQA,KAEbO,KACC,SAAUC,GACN5B,EAAOkB,eAAiBU,EAAOC,KAAKC,MACpC9B,EAAOiB,gBAAkBW,EAAOC,KAAKT,OACjCQ,EAAOC,KAAKE,MAAMC,OAClBnC,QAAQoC,QAAQL,EAAOC,KAAKE,MAAO,SAAUG,GACzClC,EAAOgB,UAAUmB,KAAKD,KAG1BlC,EAAOmB,eAAgB,GAG/B,SAAUS,GACNQ,SAASC,MAAM,oBAAoB,MAM/CrC,EAAOsC,cAAgB,WACnBtC,EAAOe,aAAaf,EAAOiB,gBAAkB,KAKjDjB,EAAOuC,cACPvC,EAAOwC,gBAAkB,EACzBxC,EAAOyC,eAAiB,EACxBzC,EAAO0C,eAAgB,EAGvB1C,EAAOc,cAAgB,SAAUM,GAC7BnB,GACIoB,OAAS,MACTC,IAAQpB,EAAW,gBACnBqB,SACIC,aAAcrB,gBAAgBsB,OAElCC,QACIN,OAAQA,KAEbO,KACC,SAAUC,GACN5B,EAAOyC,eAAiBb,EAAOC,KAAKC,MACpC9B,EAAOwC,gBAAkBZ,EAAOC,KAAKT,OACjCQ,EAAOC,KAAKE,MAAMC,OAClBnC,QAAQoC,QAAQL,EAAOC,KAAKE,MAAO,SAAUG,GACzClC,EAAOuC,WAAWJ,KAAKD,KAG3BlC,EAAO0C,eAAgB,GAG/B,SAAUd,GACNQ,SAASC,MAAM,wBAAwB,MAMnDrC,EAAO2C,gBAAkB,SAAUC,GAC/BR,SAASS,QAAQ,oBAAqB,WAIlC,IAAK,GAFDC,GAAgB,KAEXC,EAAI,EAAGC,EAAIhD,EAAOuC,WAAWP,OAAYgB,EAAJD,EAAOA,IACjD,GAAI/C,EAAOuC,WAAWQ,GAAGE,IAAML,EAAI,CAC/BE,EAAgBC,CAChB,OAKJ,OAASD,GACT7C,GACIoB,OAAS,SACTC,IAAQpB,EAAW,UAAY0C,EAAK,IACpCrB,SACIC,aAAcrB,gBAAgBsB,SAEnCE,KACC,SAAUC,GACFA,EAAOC,KAAKqB,SACZlD,EAAOuC,WAAWY,OAAOL,EAAe,IAGhD,WACIV,SAASC,MAAM,eAAe,QAUlDrC,EAAOsC,cAAgB,WACnBtC,EAAOc,cAAcd,EAAOwC,gBAAkB","file":"components/followers.js","sourcesContent":["/**\n * Follower application\n */\n\n/*global WP_API_Settings: true*/\n/*global Hametuha: true*/\n\nangular.module('hametuFollower', ['ui.bootstrap'])\n    .controller('followed', ['$scope', '$http', function ($scope, $http) {\n\n        var endpoint = WP_API_Settings.root + 'hametuha/v1/doujin/';\n\n        $scope.tabs = [\n            {\n                active: false,\n                init  : false\n            },\n            {\n                active: false,\n                init  : false\n            }\n        ];\n\n        // Activate tab\n        $scope.detectTab = function () {\n            var hash = document.location.hash;\n            switch (hash) {\n                case '#following':\n                    $scope.tabs[1].active = true;\n                    break;\n                default:\n                    $scope.tabs[0].active = true;\n                    break;\n            }\n\n        };\n\n        // Initialize followers.\n        $scope.initFollowers = function (index) {\n            if (!$scope.tabs[index].init) {\n                switch (index) {\n                    case 1:\n                        $scope.getFollowings(0);\n                        break;\n                    default:\n                        $scope.getFollowers(0);\n                        break;\n                }\n                $scope.tabs[index].init = true;\n            }\n        };\n\n        // Followers\n        $scope.followers = [];\n        $scope.followersOffset = 0;\n        $scope.followersTotal = 1;\n        $scope.followersMore = true;\n\n        // Get followers\n        $scope.getFollowers = function (offset) {\n            $http({\n                method : 'GET',\n                url   : endpoint + 'followers/me/',\n                headers: {\n                    'X-WP-Nonce': WP_API_Settings.nonce\n                },\n                params : {\n                    offset: offset\n                }\n            }).then(\n                function (result) {\n                    $scope.followersTotal = result.data.total;\n                    $scope.followersOffset = result.data.offset;\n                    if (result.data.users.length) {\n                        angular.forEach(result.data.users, function (user) {\n                            $scope.followers.push(user);\n                        });\n                    } else {\n                        $scope.followersMore = false;\n                    }\n                },\n                function (result) {\n                    Hametuha.alert('フォロワーを取得できませんでした', true);\n                }\n            );\n        };\n\n        // Get next followers\n        $scope.nextFollowers = function () {\n            $scope.getFollowers($scope.followersOffset + 20);\n        };\n\n\n        // Followings\n        $scope.followings = [];\n        $scope.followingOffset = 0;\n        $scope.followingTotal = 1;\n        $scope.followingMore = true;\n\n        // Get followings\n        $scope.getFollowings = function (offset) {\n            $http({\n                method : 'GET',\n                url   : endpoint + 'following/me/',\n                headers: {\n                    'X-WP-Nonce': WP_API_Settings.nonce\n                },\n                params : {\n                    offset: offset\n                }\n            }).then(\n                function (result) {\n                    $scope.followingTotal = result.data.total;\n                    $scope.followingOffset = result.data.offset;\n                    if (result.data.users.length) {\n                        angular.forEach(result.data.users, function (user) {\n                            $scope.followings.push(user);\n                        });\n                    } else {\n                        $scope.followingMore = false;\n                    }\n                },\n                function (result) {\n                    Hametuha.alert('フォローしている人を取得できませんでした', true);\n                }\n            );\n        };\n\n        // Remove Follower\n        $scope.removeFollowing = function (id) {\n            Hametuha.confirm('フォローを解除してよろしいですか？', function () {\n\n                var indexToRemove = null;\n\n                for (var i = 0, l = $scope.followings.length; i < l; i++) {\n                    if ($scope.followings[i].ID == id) {\n                        indexToRemove = i;\n                        break;\n                    }\n                }\n\n\n                if (null !== indexToRemove) {\n                    $http({\n                        method : 'DELETE',\n                        url   : endpoint + 'follow/' + id + '/',\n                        headers: {\n                            'X-WP-Nonce': WP_API_Settings.nonce\n                        }\n                    }).then(\n                        function (result) {\n                            if( result.data.success ){\n                                $scope.followings.splice(indexToRemove, 1);\n                            }\n                        },\n                        function () {\n                            Hametuha.alert('削除できませんでした。', true)\n                        }\n                    );\n                }\n\n            });\n\n        };\n\n        // Get next followings\n        $scope.nextFollowers = function () {\n            $scope.getFollowings($scope.followingOffset + 20);\n        };\n\n    }])\n;\n"],"sourceRoot":"/source/"}