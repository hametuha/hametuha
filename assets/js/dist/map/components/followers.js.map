{"version":3,"sources":["components/followers.js"],"names":["angular","module","controller","$scope","$http","endpoint","wpApiSettings","root","tabs","active","init","loading","detectTab","hash","document","location","initFollowers","index","getFollowings","getFollowers","followers","followersOffset","followersTotal","followersMore","offset","method","url","headers","X-WP-Nonce","nonce","params","then","result","data","total","users","length","forEach","user","push","Hametuha","alert","nextFollowers","followings","followingOffset","followingTotal","followingMore","removeFollowing","id","confirm","indexToRemove","i","l","ID","success","splice","nextFollowing"],"mappings":"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","file":"../../components/followers.js","sourcesContent":["/**\n * Follower application\n */\n\n/* global wpApiSettings: false */\n\nangular.module('hametuha')\n    .controller('followed', ['$scope', '$http', function ($scope, $http) {\n\n        'use strict';\n\n        var endpoint = wpApiSettings.root + 'hametuha/v1/doujin/';\n\n        $scope.tabs = [\n            {\n                active: false,\n                init  : false,\n                loading: false\n            },\n            {\n                active: false,\n                init  : false,\n                loading: false\n            }\n        ];\n\n        // Activate tab\n        $scope.detectTab = function () {\n            var hash = document.location.hash;\n            switch (hash) {\n                case '#following':\n                    $scope.tabs[1].active = true;\n                    break;\n                default:\n                    $scope.tabs[0].active = true;\n                    break;\n            }\n\n        };\n\n        // Initialize followers.\n        $scope.initFollowers = function (index) {\n            if (!$scope.tabs[index].init) {\n                switch (index) {\n                    case 1:\n                        $scope.getFollowings(0);\n                        break;\n                    default:\n                        $scope.getFollowers(0);\n                        break;\n                }\n                $scope.tabs[index].init = true;\n            }\n        };\n\n        // Followers\n        $scope.followers = [];\n        $scope.followersOffset = 0;\n        $scope.followersTotal = 1;\n        $scope.followersMore = true;\n\n        // Get followers\n        $scope.getFollowers = function (offset) {\n            $scope.tabs[0].loading = true;\n            $http({\n                method : 'GET',\n                url   : endpoint + 'followers/me/',\n                headers: {\n                    'X-WP-Nonce': wpApiSettings.nonce\n                },\n                params : {\n                    offset: offset\n                }\n            }).then(\n                function (result) {\n                    $scope.followersTotal = result.data.total;\n                    $scope.followersOffset = result.data.offset;\n                    if (result.data.users.length) {\n                        angular.forEach(result.data.users, function (user) {\n                            $scope.followers.push(user);\n                        });\n                    } else {\n                        $scope.followersMore = false;\n                        Hametuha.alert('フォロワーはこれ以上いません');\n                    }\n                    $scope.tabs[0].loading = false;\n                },\n                function (result) {\n                    Hametuha.alert('フォロワーを取得できませんでした', true);\n                    $scope.tabs[0].loading = false;\n                }\n            );\n        };\n\n        // Get next followers\n        $scope.nextFollowers = function () {\n            $scope.getFollowers($scope.followersOffset + 20);\n        };\n\n\n        // Followings\n        $scope.followings = [];\n        $scope.followingOffset = 0;\n        $scope.followingTotal = 1;\n        $scope.followingMore = true;\n\n        // Get followings\n        $scope.getFollowings = function (offset) {\n            $scope.tabs[1].loading = true;\n            $http({\n                method : 'GET',\n                url   : endpoint + 'following/me/',\n                headers: {\n                    'X-WP-Nonce': wpApiSettings.nonce\n                },\n                params : {\n                    offset: offset\n                }\n            }).then(\n                function (result) {\n                    $scope.followingTotal = result.data.total;\n                    $scope.followingOffset = result.data.offset;\n                    if (result.data.users.length) {\n                        angular.forEach(result.data.users, function (user) {\n                            $scope.followings.push(user);\n                        });\n                    } else {\n                        $scope.followingMore = false;\n                        Hametuha.alert('フォロワーしている人はもういません');\n                    }\n                    $scope.tabs[1].loading = false;\n                },\n                function (result) {\n                    Hametuha.alert('フォローしている人を取得できませんでした', true);\n                    $scope.tabs[1].loading = false;\n                }\n            );\n        };\n\n        // Remove Follower\n        $scope.removeFollowing = function (id) {\n            Hametuha.confirm('フォローを解除してよろしいですか？', function () {\n                var indexToRemove = null;\n\n                for (var i = 0, l = $scope.followings.length; i < l; i++) {\n                    if ($scope.followings[i].ID == id) {\n                        indexToRemove = i;\n                        break;\n                    }\n                }\n\n\n                if (null !== indexToRemove) {\n                    $scope.tabs[1].loading = true;\n                    $http({\n                        method : 'DELETE',\n                        url   : endpoint + 'follow/' + id + '/',\n                        headers: {\n                            'X-WP-Nonce': wpApiSettings.nonce\n                        }\n                    }).then(\n                        function (result) {\n                            if( result.data.success ){\n                                $scope.followings.splice(indexToRemove, 1);\n                                $scope.followingTotal--;\n                            }\n                            $scope.tabs[1].loading = false;\n                        },\n                        function () {\n                            Hametuha.alert('削除できませんでした。', true);\n                            $scope.tabs[1].loading = false;\n                        }\n                    );\n                }\n\n            }, true);\n\n        };\n\n        // Get next followings\n        $scope.nextFollowing = function () {\n            $scope.getFollowings($scope.followingOffset + 20);\n        };\n\n    }])\n;\n"]}