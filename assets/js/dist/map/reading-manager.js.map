{"version":3,"sources":["reading-manager.js"],"names":["$","hametuhaReadingManager","window","HametuhaReadingManager","alert","string","bookmarks","tweet","link","jQuery","attr","twitterBaseUri","tweetURI","encodeURIComponent","open","focus","saveFrase","postID","frase","location","post","HametuhaVars","endpoint","action","addFavorite","_wpnonce","nonce","post_id","result","message","status","getContainer","showNotification","addReview","fancybox","href","feedbackURL","title","type","width","isOpen","css","toggleMetaPanel","e","preventDefault","prop","this","left","search","str","searchContent","navigator","appName","indexOf","reader","document","fitHeight","winHeight","hasClass","innerHeight","height","embed","swfobject","embedSWF","swf","expressInstall","userID","getContent","postTitle","postAuthor","fontURL","fontSwf","isPreview","wmode","quality","allowScriptAccess","allowFullScreen","curPage","totalPage","pageWidth","startTime","startX","latestX","setupPagenation","movePos","page","Math","max","scrollLeft","nextPage","prevPage","touchStart","Date","getTime","originalEvent","touches","pageX","bind","touchMove","touchEnd","unbind","moved","passed","abs","innerWidth","ready","length","content","remove","click","parents","addClass","blur","removeClass","submit","searchStr","val","timer","setInterval","rest","parseInt","text","clearInterval","resize","append","setTimeout","scrollTo","scroll"],"mappings":"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","file":"reading-manager.js","sourcesContent":["/**\n * 破滅派の読み込みを司るクラス\n */\n\n/* global HametuhaVars:true */\n/* global swfobject:true */\n\n\n\n\n(function($){\n\n    \"use strict\";\n\n    var hametuhaReadingManager = window.HametuhaReadingManager = {\n\n        alert: function(string){\n            window.alert(string);\n        },\n\n        bookmarks:{\n\n        },\n\n        tweet: function(string){\n            var link = jQuery('link[rel=canonical]').attr('href');\n            var twitterBaseUri = 'http://twitter.com/home?status=';\n            var tweetURI = twitterBaseUri + encodeURIComponent('QT: ' + string + ' ' + link + ' ' + '#破滅派');\n            window.open(tweetURI, 'twitter', 'width=600, height=400, menubar=no, toolbar=no, scrollbars=yes').focus();\n        },\n\n        saveFrase: function(postID, frase, location){\n            jQuery.post(\n                HametuhaVars.endpoint,\n                {\n                    action: HametuhaVars.addFavorite,\n                    _wpnonce: HametuhaVars.nonce,\n                    post_id: postID,\n                    location: location,\n                    frase: frase\n                },\n                function(result){\n                    var message = result.status ? 'テキストをお気に入りに登録しました。': 'ごめんなさい、エラーが起きたためお気に入りに登録できませんでした。';\n                    hametuhaReadingManager.getContainer().showNotification(message);\n                }\n            );\n        },\n\n        addReview: function(postID){\n            jQuery.fancybox.open(\n                {\n                    href: HametuhaVars.feedbackURL + '&post_id=' + postID,\n                    title: '作品を評価する'\n                },\n                {\n                    type: 'iframe',\n                    width: 700\n                }\n            );\n        },\n\n        isOpen: function(){\n            return jQuery(\"#reading-container\").css('left') != '-100%';\n        },\n\n        toggleMetaPanel: function(e){\n            if(e){\n                e.preventDefault();\n            }\n            var prop;\n            switch(jQuery(this).attr('id')){\n                case 'meta-drawer':\n                    prop = '-100%';\n                    break;\n                default:\n                    prop = 0;\n                    break;\n            }\n            jQuery('#reading-container').css({\n                left: prop\n            });\n        },\n\n        search: function(str){\n            this.getContainer().searchContent(str);\n        },\n\n        getContainer: function(){\n            if (navigator.appName.indexOf(\"Microsoft\") != -1) {\n                 return window.reader;\n             } else {\n                 return document.reader;\n             }\n        },\n\n        fitHeight: function(){\n            var winHeight = jQuery('body').hasClass('mobile') ? window.innerHeight : jQuery(window).height();\n            jQuery('#reading-container').css('height', winHeight - (jQuery('#wpadminbar').height() + jQuery('#post-feedback').height()) );\n            if(jQuery('body').hasClass('mobile')){\n                jQuery('#reading-container .inner').css('height',jQuery('#reading-container').height() - 100);\n                //jQuery('body').css('minHeight', window.innerHeight + 1);\n            }\n        },\n\n        embed: function(){\n            swfobject.embedSWF(\n                HametuhaVars.swf,\n                'reader',\n                '100%',\n                '100%',\n                '10.2.0',\n                HametuhaVars.expressInstall,\n                {\n                    endpoint: HametuhaVars.endpoint,\n                    userID: HametuhaVars.userID,\n                    postID: HametuhaVars.postID,\n                    getContent: HametuhaVars.getContent,\n                    postTitle: HametuhaVars.postTitle,\n                    postAuthor: HametuhaVars.postAuthor,\n                    fontURL: HametuhaVars.fontSwf,\n                    isPreview: HametuhaVars.isPreview\n                },\n                {\n                    wmode: 'transparent',\n                    quality: 'AUTOHIGH',\n                    allowScriptAccess: 'always',\n                    allowFullScreen: true\n                }\n            );\n        },\n\n        width: 0,\n\n        curPage: 1,\n\n        totalPage: 0,\n\n        pageWidth: 0,\n\n        startTime: 0,\n\n        startX: 0,\n\n        latestX: 0,\n\n\n\n        setupPagenation: function(){\n            this.curPage = 1;\n            this.width = $('.post-content', '#reading-container').width();\n            this.pageWidth = $('.inner', '#reading-container').width();\n            this.totalPage = $('.post-content', '#reading-container').width() / this.pageWidth;\n        },\n\n        movePos: function (page){\n            page = Math.max(1, page);\n            $('.inner', '#reading-container').scrollLeft(this.width - (page - 1) * this.pageWidth);\n            this.curPage = page;\n        },\n\n        nextPage: function (){\n            this.curPage++;\n            this.movePos(this.curPage);\n        },\n\n        prevPage: function (){\n            this.curPage--;\n            if(this.curPage < 1){\n                this.curPage = 1;\n            }else{\n                this.movePos(this.curPage);\n            }\n        },\n\n        touchStart: function(e){\n            hametuhaReadingManager.startTime = (new Date()).getTime();\n            hametuhaReadingManager.startX = hametuhaReadingManager.latestX = e.originalEvent.touches[0].pageX;\n            jQuery('#reading-container .inner').bind('touchmove', hametuhaReadingManager.touchMove);\n        },\n\n        touchMove: function(e){\n            hametuhaReadingManager.latestX = e.originalEvent.touches[0].pageX;\n        },\n\n        touchEnd: function(e){\n            $('#reading-container .inner').unbind('touchmove', hametuhaReadingManager.touchMove);\n            var moved = hametuhaReadingManager.latestX - hametuhaReadingManager.startX,\n                passed = (new Date()).getTime() - hametuhaReadingManager.startTime;\n            if(passed > 1999){\n                //2秒以上なら関係ない\n                return;\n            }\n            if(Math.abs(moved) < window.innerWidth / 2 ){\n                //画面の半分以上フリックしてない\n                return;\n            }\n            /*\n            if(moved < 0){\n                hametuhaReadingManager.prevPage();\n            }else{\n                hametuhaReadingManager.nextPage();\n            }\n            //スクロールする\n            hametuhaReadingManager.startTime = 0;\n            hametuhaReadingManager.startX = 0;\n            hametuhaReadingManager.latestX = 0;\n            */\n        }\n    };\n})(jQuery);\n\n//DomReady\njQuery(document).ready(function($){\n\n    \"use strict\";\n\n    var hametuhaReadingManager = window.HametuhaReadingManager;\n\n\tif($('#reading-container').length > 0){\n\t\t//元コンテンツを削除\n\t\tvar content = $('.single-post-content').remove();\n\t\t$('#meta-drawer, #meta-opener').click(hametuhaReadingManager.toggleMetaPanel);\n\t\t//検索ボックス\n\t\t$('#search').focus(function(e){\n\t\t\t$(this).parents('form').addClass('active');\n\t\t});\n\t\t$('#search').blur(function(e){\n\t\t\t$(this).parents('form').removeClass('active');\n\t\t});\n\t\t$('#search-box').submit(function(e){\n\t\t\te.preventDefault();\n\t\t\tvar searchStr = $('#search').val();\n\t\t\tif(searchStr.length > 0){\n\t\t\t\thametuhaReadingManager.search(searchStr);\n\t\t\t}\n\t\t});\n\t\t//カウントダウン開始\n\t\tvar timer = setInterval(function(){\n\t\t\tvar rest = parseInt($('#reader-open-indicator strong').text()) - 1;\n\t\t\tif(rest < 0){\n\t\t\t\t$('#reader-open-indicator').remove();\n\t\t\t\tclearInterval(timer);\n\t\t\t\tif(!hametuhaReadingManager.isOpen()){\n\t\t\t\t\thametuhaReadingManager.toggleMetaPanel(false);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$('#reader-open-indicator strong').text(rest);\n\t\t}, 1000);\n\t\t//Flash用コンテナのサイズを調整\n\t\thametuhaReadingManager.fitHeight();\n\t\t//リサイズされた場合\n\t\tjQuery(window).resize(function(e){\n\t\t\thametuhaReadingManager.fitHeight();\n\t\t});\n\t\t//エンベッド\n\t\tif($('body').hasClass('mobile')){\n\t\t\t$('#reading-container .inner').append(content);\n\t\t\tsetTimeout(function(){\n\t\t\t\twindow.scrollTo(0, 1);\n\t\t\t\thametuhaReadingManager.fitHeight();\n\t\t\t}, 100);\n\t\t\t$(window).scroll(hametuhaReadingManager.fitHeight);\n\t\t\thametuhaReadingManager.setupPagenation();\n\t\t\thametuhaReadingManager.movePos(1);\n\t\t}else{\n\t\t\thametuhaReadingManager.embed();\n\t\t}\n\t}\n});\n\n"],"sourceRoot":"/source/"}