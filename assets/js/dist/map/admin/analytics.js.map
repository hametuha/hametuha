{"version":3,"sources":["admin/analytics.js"],"names":["$","google","load","document","ready","datepicker","dateFormat","changeYear","setOnLoadCallback","stats","on","e","url","from","to","$stat","this","id","attr","removeClass","addClass","get","done","result","data","visualization","ChartWrapper","chartType","containerId","find","setOptions","options","cols","setDataTable","dataSet","arrayToDataTable","draw","fail","xhr","status","error","window","alert","always","initialized","submit","preventDefault","val","trigger","history","pushState","title","location","pathname","timer","resize","clearTimeout","setTimeout","hasOwnProperty","jQuery"],"mappings":"CAMA,SAAWA,GAEP,YAGAC,QAAOC,KAAK,gBAAiB,IAAK,MAGlCF,EAAEG,UAAUC,MAAM,WAEdJ,EAAE,eAAeK,YACbC,WAAY,WACZC,YAAY,MAMpBN,OAAOO,kBAAkB,WAGrB,GAAIC,KAGJT,GAAE,SAASU,GAAG,4BAA6B,SAASC,EAAGC,EAAKC,EAAMC,GAC9D,GAAIC,GAAQf,EAAEgB,MACVC,EAAKF,EAAMG,KAAK,KACpBH,GAAMI,YAAY,WAAWC,SAAS,WACtCpB,EAAEqB,IAAIN,EAAMG,KAAK,kBACbL,KAAMA,EACNC,GAAIA,IACLQ,KAAK,SAASC,GACb,GAAIA,GAAUA,EAAOC,KAAK,CAQtB,GAPKf,EAAMQ,KACPR,EAAMQ,GAAM,GAAIhB,QAAOwB,cAAcC,cACjCC,UAAWZ,EAAMG,KAAK,aACtBU,YAAab,EAAMc,KAAK,oBAAoBX,KAAK,SAGzDT,EAAMQ,GAAIa,WAAWP,EAAOQ,SACxBR,EAAOC,KAAKQ,KACZvB,EAAMQ,GAAIgB,aAAaV,EAAOC,UAC7B,CACD,GAAIU,GAAUjC,OAAOwB,cAAcU,iBAAiBZ,EAAOC,KAC3Df,GAAMQ,GAAIgB,aAAaC,GAE3BzB,EAAMQ,GAAImB,WAEVrB,GAAMK,SAAS,aAEpBiB,KAAK,SAASC,EAAKC,EAAQC,GAC1BC,OAAOC,MAAMF,KACdG,OAAO,WACN5B,EAAMI,YAAY,cAM1B,IAAIyB,IAAc,CAClB5C,GAAE,wBAAwB6C,OAAO,SAASlC,GACtCA,EAAEmC,gBACF,IAAIjC,GAAOb,EAAEgB,MAAMa,KAAK,oBAAoBkB,MACxCjC,EAAMd,EAAEgB,MAAMa,KAAK,kBAAkBkB,KACzC/C,GAAE,SAASgD,QAAQ,6BAA8BhD,EAAEgB,MAAME,KAAK,UAAWL,EAAMC,IAE3E2B,OAAOQ,SAAWR,OAAOQ,QAAQC,YAC7BN,EAGAK,QAAQC,WACJrC,KAAMA,EACNC,GAAIA,GACLX,SAASgD,MAAOV,OAAOW,SAASC,SAAW,SAAWxC,EAAO,OAASC,GALzE8B,GAAc,KAQvBI,QAAQ,SAIX,IAAIM,GAAQ,IACZtD,GAAEyC,QAAQc,OAAO,WACTD,GACAE,aAAaF,GAEjBA,EAAQG,WAAW,WACf,IAAK,GAAIxC,KAAMR,GACPA,EAAMiD,eAAezC,IACrBR,EAAMQ,GAAImB,QAGnB,UAIZuB","file":"../../admin/analytics.js","sourcesContent":["/**\n * Description\n */\n\n/*global google: true*/\n\n(function ($) {\n\n    'use strict';\n\n    // Load visualization\n    google.load('visualization', '1', null);\n\n    // Register date picker\n    $(document).ready(function(){\n        // Date picker\n        $('.datepicker').datepicker({\n            dateFormat: 'yy-mm-dd',\n            changeYear: true\n        });\n    });\n\n\n    // Callback after chart is ready\n    google.setOnLoadCallback(function(){\n\n        // Stats store\n        var stats = {};\n\n        // Bind ajax event\n        $('.stat').on('update.analytics.hametuha', function(e, url, from, to){\n            var $stat = $(this),\n                id = $stat.attr('id');\n            $stat.removeClass('no-data').addClass('loading');\n            $.get($stat.attr('data-endpoint'), {\n                from: from,\n                to: to\n            }).done(function(result){\n                if( result && result.data){\n                    if( !stats[id] ){\n                        stats[id] = new google.visualization.ChartWrapper({\n                            chartType: $stat.attr('data-type'),\n                            containerId: $stat.find('.stat__container').attr('id')\n                        });\n                    }\n                    stats[id].setOptions(result.options);\n                    if( result.data.cols ){\n                        stats[id].setDataTable(result.data);\n                    }else{\n                        var dataSet = google.visualization.arrayToDataTable(result.data);\n                        stats[id].setDataTable(dataSet);\n                    }\n                    stats[id].draw();\n                }else{\n                    $stat.addClass('no-data');\n                }\n            }).fail(function(xhr, status, error){\n                window.alert(error);\n            }).always(function(){\n                $stat.removeClass('loading');\n            });\n        });\n\n\n        // Bind form event and trigger immediately\n        var initialized = false;\n        $('#analytics-date-form').submit(function(e){\n            e.preventDefault();\n            var from = $(this).find(\"input[name=from]\").val(),\n                to =  $(this).find(\"input[name=to]\").val();\n            $('.stat').trigger('update.analytics.hametuha', [$(this).attr('action'), from, to]);\n            // Push state( So you can reload)\n            if (window.history && window.history.pushState){\n                if(!initialized){\n                    initialized = true;\n                }else{\n                    history.pushState({\n                        from: from,\n                        to: to\n                    }, document.title, window.location.pathname + '?from=' + from + '&to=' + to);\n                }\n            }\n        }).trigger('submit');\n\n\n        // Resize chart\n        var timer = null;\n        $(window).resize(function(){\n            if( timer ){\n                clearTimeout(timer);\n            }\n            timer = setTimeout(function(){\n                for( var id in stats ){\n                    if( stats.hasOwnProperty(id) ){\n                        stats[id].draw();\n                    }\n                }\n            }, 500);\n        });\n    });\n\n})(jQuery);\n"]}