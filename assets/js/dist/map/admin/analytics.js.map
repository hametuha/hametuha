{"version":3,"sources":["admin/analytics.js"],"names":["$","google","load","document","ready","datepicker","dateFormat","changeYear","setOnLoadCallback","stats","bind","e","url","from","to","$stat","this","id","attr","action","nonce","removeClass","addClass","get","_wpnonce","done","result","data","visualization","ChartWrapper","chartType","containerId","find","setOptions","options","cols","setDataTable","dataSet","arrayToDataTable","draw","fail","xhr","status","error","window","alert","always","submit","preventDefault","$form","trigger","val","timer","resize","clearTimeout","setTimeout","hasOwnProperty","jQuery"],"mappings":"CAMA,SAAWA,GAEP,YAGAC,QAAOC,KAAK,gBAAiB,IAAK,MAGlCF,EAAEG,UAAUC,MAAM,WAEdJ,EAAE,eAAeK,YACbC,WAAY,WACZC,YAAY,MAKpBN,OAAOO,kBAAkB,WAGrB,GAAIC,KAGJT,GAAE,SAASU,KAAK,4BAA6B,SAASC,EAAGC,EAAKC,EAAMC,GAChE,GAAIC,GAAQf,EAAEgB,MACVC,EAAKF,EAAMG,KAAK,MAChBC,EAASJ,EAAMG,KAAK,eACpBE,EAAQL,EAAMG,KAAK,aAClBC,IAAWC,IAGhBL,EAAMM,YAAY,WAAWC,SAAS,WACtCtB,EAAEuB,IAAIX,GACFO,OAAQA,EACRK,SAAUJ,EACVP,KAAMA,EACNC,GAAIA,IACLW,KAAK,SAASC,GACb,GAAIA,GAAUA,EAAOC,KAAK,CAQtB,GAPKlB,EAAMQ,KACPR,EAAMQ,GAAM,GAAIhB,QAAO2B,cAAcC,cACjCC,UAAWf,EAAMG,KAAK,aACtBa,YAAahB,EAAMiB,KAAK,OAAOd,KAAK,SAG5CT,EAAMQ,GAAIgB,WAAWP,EAAOQ,SACxBR,EAAOC,KAAKQ,KACZ1B,EAAMQ,GAAImB,aAAaV,EAAOC,UAC7B,CACD,GAAIU,GAAUpC,OAAO2B,cAAcU,iBAAiBZ,EAAOC,KAC3DlB,GAAMQ,GAAImB,aAAaC,GAE3B5B,EAAMQ,GAAIsB,WAEVxB,GAAMO,SAAS,aAEpBkB,KAAK,SAASC,EAAKC,EAAQC,GAC1BC,OAAOC,MAAMF,KACdG,OAAO,WACN/B,EAAMM,YAAY,gBAM1BrB,EAAE,wBAAwB+C,OAAO,SAASpC,GACtCA,EAAEqC,gBACF,IAAIC,GAAQjD,EAAEgB,KACdhB,GAAE,SAASkD,QAAQ,6BAA8BD,EAAM/B,KAAK,UAAW+B,EAAMjB,KAAK,oBAAoBmB,MAAOF,EAAMjB,KAAK,kBAAkBmB,UAC3ID,QAAQ,SAIX,IAAIE,GAAQ,IACZpD,GAAE4C,QAAQS,OAAO,WACTD,GACAE,aAAaF,GAEjBA,EAAQG,WAAW,WACf,IAAK,GAAItC,KAAMR,GACPA,EAAM+C,eAAevC,IACrBR,EAAMQ,GAAIsB,QAGnB,UAIZkB","file":"admin/analytics.js","sourcesContent":["/**\n * Description\n */\n\n/*global google: true*/\n\n(function ($) {\n\n    'use strict';\n\n    // Load visualization\n    google.load('visualization', '1', null);\n\n    // Register date picker\n    $(document).ready(function(){\n        // Date picker\n        $('.datepicker').datepicker({\n            dateFormat: 'yy-mm-dd',\n            changeYear: true\n        });\n    });\n\n    // Callback after chart is ready\n    google.setOnLoadCallback(function(){\n\n        // Stats store\n        var stats = {};\n\n        // Bind ajax event\n        $('.stat').bind('update.analytics.hametuha', function(e, url, from, to){\n            var $stat = $(this),\n                id = $stat.attr('id'),\n                action = $stat.attr('data-action'),\n                nonce = $stat.attr('data-nonce');\n            if( !action || !nonce ){\n                return;\n            }\n            $stat.removeClass('no-data').addClass('loading');\n            $.get(url, {\n                action: action,\n                _wpnonce: nonce,\n                from: from,\n                to: to\n            }).done(function(result){\n                if( result && result.data){\n                    if( !stats[id] ){\n                        stats[id] = new google.visualization.ChartWrapper({\n                            chartType: $stat.attr('data-type'),\n                            containerId: $stat.find('div').attr('id')\n                        });\n                    }\n                    stats[id].setOptions(result.options);\n                    if( result.data.cols ){\n                        stats[id].setDataTable(result.data);\n                    }else{\n                        var dataSet = google.visualization.arrayToDataTable(result.data);\n                        stats[id].setDataTable(dataSet);\n                    }\n                    stats[id].draw();\n                }else{\n                    $stat.addClass('no-data');\n                }\n            }).fail(function(xhr, status, error){\n                window.alert(error);\n            }).always(function(){\n                $stat.removeClass('loading');\n            });\n        });\n\n\n        // Bind form event and trigger immediately\n        $('#analytics-date-form').submit(function(e){\n            e.preventDefault();\n            var $form = $(this);\n            $('.stat').trigger('update.analytics.hametuha', [$form.attr('action'), $form.find(\"input[name=from]\").val(), $form.find(\"input[name=to]\").val()]);\n        }).trigger('submit');\n\n\n        // Resize chart\n        var timer = null;\n        $(window).resize(function(){\n            if( timer ){\n                clearTimeout(timer);\n            }\n            timer = setTimeout(function(){\n                for( var id in stats ){\n                    if( stats.hasOwnProperty(id) ){\n                        stats[id].draw();\n                    }\n                }\n            }, 500);\n        });\n    });\n\n})(jQuery);\n"],"sourceRoot":"/source/"}