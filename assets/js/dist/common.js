!function(e){"use strict";window.Hametuha={ga:{hitEvent:function(e,t,a,n,i){try{"undefined"==typeof n&&(n=1),ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:a,eventValue:n,nonInteraction:!!i})}catch(o){}},eventOutbound:function(e,t,a,n,i,o){try{"undefined"==typeof o&&(o=1),ga("send",{hitType:"event",eventCategory:a,eventAction:n,eventLabel:i,eventValue:o,hitCallback:function(){Modernizr.touch?window.location.href=t:"share"===a?window.open(t,"outbound","width=520, height=350"):window.open(t,"outbound")}}),e.preventDefault()}catch(s){}}},str:{yakumono:/^[ 　【】《〔〝『「（”"'’\(\)]/,startYakumono:function(e){return this.yakumono.test(e)}},alert:function(t,a,n){var i,o,s;switch(void 0===n&&(n=7e3),a){case"info":case"danger":case"warning":i=a;break;case!0:case"error":i="danger";break;default:i="success"}o='<div class="alert alert-'+i+' alert-dismissible alert-sticky" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+t+"</div>",s=e(o),e("body").append(s),setTimeout(function(){s.addClass("alert-sticky-on")},10),setTimeout(function(){s.remove()},n)},confirm:function(e,t,a){bootbox.dialog({title:"確認",message:e,buttons:{cancel:{label:"キャンセル",className:"btn-default"},ok:{label:a?"実行":"OK",className:a?"btn-danger":"btn-success",callback:t}}})},isTategaki:function(){return e("body").hasClass("tategaki")},template:function(e){return HametuhaGlobal.angularTemplateDir+e},models:{},views:{},collections:{},modal:{open:function(t,a){this.reset();var n=e("#hametu-modal");n.find(".modal-title").html(t),"function"==typeof a?(n.addClass("loading"),a(n)):n.find(".modal-body").html(a),n.modal("show")},close:function(){var t=e("#hametu-modal");this.reset(),t.modal("hide")},reset:function(){var t=e("#hametu-modal");t.find(".modal-title").html(""),t.find(".modal-body").html("")}}}}(jQuery),function(e){"use strict";e(document).on("click",".anpi-new",function(t){t.preventDefault(),Hametuha.modal.open("安否報告",function(t){e.post("/anpi/mine/new/").done(function(e){t.removeClass("loading").find(".modal-body").append(e.html)}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0),Hametuha.modal.close()})})}),e(document).on("submit","#new-tweet-form",function(t){t.preventDefault();var a,n,i=e(this).find("#new-tweet-id");n={content:e.trim(e(this).find("#new-anpi-content").val())},n.content.length&&(i.length?a="PUT":(a="POST",n.mention=e(this).find("#mention").val()),e.ajax({method:a,url:WP_API_Settings.root+"hametuha/v1/anpi/new/",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)},data:n}).done(function(e){Hametuha.alert("めつかれさまでした。安否報告を受け付けました。")}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0)}).always(function(e){Hametuha.modal.close()}))})}(jQuery),jQuery(document).ready(function(e){"use strict";window.Hametuha;e("form").submit(function(){e(this).find("input[type=submit]").attr("disabled",!0)}),e(".pseudo-uploader").each(function(t,a){var n=e(a).next("input");e(a).on("click",".btn",function(e){e.preventDefault(),n.trigger("click")}),n.change(function(t){var n=e(this).val().split("\\");e(a).find("input[type=text]").val(n[n.length-1])})}),e(".form-unlimiter").click(function(t){e(this).parents("form").find("input[type=submit]").prop("disabled",!e(this).attr("checked"))}),e("a[data-confirm], input[data-confirm]").click(function(t){return window.confirm(e(this).attr("data-confirm"))?void 0:!1}),e(".validator").submit(function(t){e(this).find("runtime-error").remove();var a=[];e(this).find(".required").each(function(t,n){if(!e(n).val()){e(n).addClass("erro");var i=e("label[for="+e(n).attr("id")+"]",this);i.length&&a.push(i.text()+"は必須項目です。")}}),a.length&&t.preventDefault()}),e(document).on("submit","#searchBox form",function(){var t=e(this).find("input[name=post_type]:checked");switch(t.val()){case"any":t.attr("checked",!1);break;case"author":e(this).attr("action",t.attr("data-search-action")),t.attr("checked",!1)}})}),function(e){"use strict";e(document).on("click","a[data-stock]",function(t){var a=e(this),n=a.attr("data-stock");t.preventDefault(),a.attr("disabled",!0),e.ajax({url:WP_API_Settings.root+"hametuha/v1/idea/"+n+"/",method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)}}).done(function(e){a.attr("data-stock",null).text("ストック済み"),Hametuha.alert("このアイデアをストックしました。")}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0),a.attr("disabled",!1)})}),e(document).on("click","a[data-recommend]",function(t){var a=e(this);a.attr("data-recommend");t.preventDefault(),Hametuha.modal.open("アイデアを薦める",function(t){e.post(a.attr("href")).done(function(e){t.removeClass("loading").find(".modal-body").append(e.html)}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0),Hametuha.modal.close()})})}),e(document).on("submit","#recommend-idea-form",function(t){t.preventDefault(),e.ajax({method:"PUT",url:WP_API_Settings.root+"hametuha/v1/idea/"+e(this).attr("data-post-id")+"/",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)},data:{user_id:e(this).find("#recommend_to").val()}}).done(function(e){Hametuha.alert(e.message),Hametuha.modal.close()}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0)})}),e(document).on("click",'a[data-action="post-idea"]',function(t){t.preventDefault();var a=e(this);Hametuha.modal.open("アイデアを投稿する",function(t){e.post(a.attr("href")).done(function(e){t.removeClass("loading").find(".modal-body").append(e.html)}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0),Hametuha.modal.close()})})}),e(document).on("submit","#new-idea-form",function(t){t.preventDefault();var a,n,i="hametuha/v1/idea/mine/",o=e(this).find("#new-idea-id");n={title:e("#new-idea-name").val(),content:e("#new-idea-content").val(),status:e("#new-idea-privacy").attr("checked")?"private":"publish",genre:e("#new-idea-genre").val()},o.length?(a="PUT",n.post_id=o.val()):a="POST",e.ajax({method:a,url:WP_API_Settings.root+i,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)},data:n}).done(function(e){Hametuha.modal.close(),window.location.href===e.url?(Hametuha.alert(e.message+"3秒後にページを更新します……"),setTimeout(function(){window.location.reload()},3e3)):Hametuha.alert(e.message+'<a class="alert-link" href="'+e.url+'">アイデアのページヘ移動する</a>')}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0)})}),e(document).on("click",'a[data-action="delete-idea"]',function(t){t.preventDefault();var a=e(this).attr("data-post-id");Hametuha.confirm("このアイデアを削除してよろしいですか？",function(){e.ajax({method:"DELETE",url:WP_API_Settings.root+"hametuha/v1/idea/mine/?post_id="+a,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)}}).done(function(e){Hametuha.alert(e.message)}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,"danger")})},!0)}),e(document).on("click",'a[data-action="edit-idea"]',function(t){var a=e(this).attr("href");t.preventDefault(),Hametuha.modal.open("アイデアを編集する",function(t){e.post(a).done(function(e){t.removeClass("loading").find(".modal-body").append(e.html)}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,"danger"),Hametuha.modal.close()})})})}(jQuery),jQuery(document).ready(function(e){"use strict";e(document).on("click","a.list-creator",function(t){t.preventDefault();var a=e(this).attr("href");Hametuha.modal.open(e(this).attr("title"),function(t){e.get(a,{},function(e){t.removeClass("loading"),t.find(".modal-body").html(e.html)})})}),e(document).on("submit",".list-create-form",function(t){t.preventDefault();var a=e(this);a.addClass("loading"),a.ajaxSubmit({success:function(e){e.success?a.trigger("created.hametuha",[e.post]):Hametuha.alert(e.message,!0),a.find("input[type=submit]").attr("disabled",!1),a.removeClass("loading")}})}),e(".modal").on("created.hametuha",".list-create-form",function(t,a){Hametuha.modal.close(),Hametuha.ga.hitEvent("list","add",a.ID),e("body").hasClass("single-lists")&&location.reload()}),e(document).on("submit",".list-save-manager",function(t){t.preventDefault();var a=e(this);a.addClass("loading"),a.ajaxSubmit({success:function(t){a.find("input[type=submit]").attr("disabled",!1),a.removeClass("loading");var n=e('<div class="alert alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">閉じる</span></button></div>');n.addClass("alert-"+(t.success?"success":"danger")).append("<span>"+t.message+"</span>"),a.prepend(n),setTimeout(function(){n.find("button").trigger("click")},5e3)}})}),e(document).on("click",".list-eraser",function(t){t.preventDefault(),Hametuha.confirm(e(this).attr("title"),function(){e.post(e(this).attr("href"),function(t){Hametuha.alert(t.message),t.success&&e("body").hasClass("single-lists")&&(window.location.href=t.url)})},!0)});var t=e("#my-list-deleter");t.length&&(e("ol.media-list > li").each(function(a,n){e(n).find(".list-inline").append(t.render({postId:e(n).attr("data-post-id")}))}),e("ol.media-list").on("click",".deregister-button",function(t){t.preventDefault();var a=e(this);Hametuha.confirm("リストからこの作品を削除します。この操作は取り消せませんが、よろしいですか？",function(){e.post(a.attr("href"),{},function(t){t.success?(a.parents("li.media").remove(),e("ol.media-list > li").length||(e("ol.media-list").before('<div class="alert alert-danger">'+t.message+"</div>"),setTimeout(function(){window.location.href=t.home_url},3e3))):Hametuha.alert(t.message,!0)})},!0)}))}),jQuery(document).ready(function(e){"use strict";e(".row--share").each(function(t,a){var n=e(this);e.get(n.attr("data-share-url")).done(function(e){if(e.success)for(var t in e.result)e.result.hasOwnProperty(t)&&n.find("a.share--"+t+" span").text(e.result[t])}).fail(function(){}).always(function(){})}),e(document).on("click","a.share",function(t){var a=window.Hametuha.ga,n=e(this).attr("data-medium"),i=e(this).attr("href"),o=e(this).attr("data-target");switch(n){case"facebook":try{FB.ui({method:"share",href:i},function(e){e&&a.hitEvent("share",n,o)}),t.preventDefault()}catch(s){}break;case"hatena":break;default:a.eventOutbound(t,i,"share",n,o)}}),e(document).on("click","a[data-outbound]",function(t){var a=e(this).attr("href"),n=e(this).attr("data-outbound"),i=e(this).attr("data-action"),o=e(this).attr("data-label"),s=e(this).attr("data-value")||1;n&&i&&o&&Hametuha.ga.eventOutbound(event,a,n,i,o,s)});var t=setInterval(function(){if(window.FB&&window.FB.Event){clearInterval(t);var a={create:"like",remove:"dislike"};e.each(a,function(e,t){FB.Event.subscribe("edge."+e,function(e){try{ga("send",{hitType:"social",socialNetwork:"facebook",socialAction:t,socialTarget:e.replace(/^https?:\/\/hametuha\.(com|info)/,"")})}catch(a){}})})}},100),a=setInterval(function(){window.twttr&&window.twttr.events&&(clearInterval(a),e.each(["follow","tweet","retweet","click","favorite"],function(e,t){window.twttr.events.bind(t,function(e){try{ga("send",{hitType:"social",socialNetwork:"twitter",socialAction:t,socialTarget:window.location.pathname})}catch(a){}})}))},100)}),jQuery(document).ready(function(e){"use strict";e("[data-toggle=offcanvas]").click(function(){e("body").toggleClass("offcanvas-on")}),e(".help-tip").tooltip({trigger:"hover focus click",container:"body"});var t=e("#profile-navi");if(t.length){var a={};e("section","#your-profile").each(function(t,n){var i="profile-section-"+(t+1);e(n).attr("id",i),a[i]=e(n).find("h2, h3:first-child").text()});for(var n in a)a.hasOwnProperty(n)&&t.append('<li><a href="#'+n+'">'+a[n]+"</a></li>")}e(".subnav__link--toggle").click(function(t){var a=e(e(this).attr("data-target"));t.preventDefault(),a.hasClass("toggle")?(e(".subnav__child").addClass("toggle"),a.removeClass("toggle")):e(".subnav__child").addClass("toggle")})}),function(e){"use strict";e(document).on("keydown",".user-picker__input",function(e){return 13==e.keyCode?(e.preventDefault(),!1):void 0});var t,a=!1;e(document).on("keyup",".user-picker__input",function(n){if(!a){t&&clearTimeout(t);var i=e(this),o=i.parents(".user-picker"),s=i.next(".user-picker__placeholder"),r={};t=setTimeout(function(){a=!0,s.removeClass("empty").addClass("loading"),s.find(".user-picker__item").each(function(t,a){e(a).find(".user-picker__link.active").length||e(a).remove()}),e.ajax({url:WP_API_Settings.root+"hametuha/v1/doujin/following/me/?s="+i.val(),method:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WP_API_Settings.nonce)}}).done(function(t){if(t.users.length){var a=o.attr("data-target");r.hasOwnProperty(a)||(r[a]=e.templates(a+"-template")),e.each(t.users,function(e,t){s.append(r[a].render(t))})}}).fail(function(e){var t=e.responseJSON?e.responseJSON.message:"失敗しました。";Hametuha.alert(t,!0)}).always(function(){s.removeClass("loading"),s.find(".user-picker__item").length||s.addClass("empty"),t=null,a=!1})},1e3)}}),e(document).on("click",".user-picker__link",function(t){t.preventDefault(),e(this).toggleClass("active");var a=e(this).parents(".user-picker"),n=[],i=parseInt(a.attr("data-max"),10);e(this).hasClass("active")||(e(this).parent("li").remove(),a.removeClass("filled")),a.find(".user-picker__link.active").each(function(t,a){n.push(e(a).attr("data-user-id"))}),i<=n.length&&(a.addClass("filled"),a.find(".user-picker__link:not(.active)").each(function(t,a){e(a).parent("li").remove()})),e(a.attr("data-target")).val(n.join(","))})}(jQuery);
//# sourceMappingURL=map/common.js.map