{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./assets/js/src/hashboard/requests.jsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","$","jQuery","Vue","component","template","props","type","String","default","request","computed","approved","this","ratio","revenue","parseInt","actions","btn","push","label","method","className","mounted","methods","handleClick","$emit","id","post_id","window","confirm","console","log","concat","el","data","curPage","total","loading","requests","required","beforeMount","$el","getAttribute","fetch","page","_this","wp","apiFetch","path","parse","then","res","headers","json","catch","hbErrorMessage","message","finally","pagination","number","approvedHandler","userId","postId","_this2","series_id","hbMessage","deniedHandler","_this3"],"mappings":"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","file":"requests.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","/*!\n * wpdeps=hb-components-loading,wp-api-fetch,hashboard-rest,hb-components-pagination, hb-filters-moment\n */\n\n/*global Vue:false*/\n\nconst $ = jQuery;\n\nVue.component( 'hametuha-request', {\n  template: `\n    <li class=\"hametuha-request-item list-group-item\">\n        <div class=\"d-flex w-100 justify-content-between mb-1\">\n          <h5>共同編集者としての招待</h5>\n          <small>{{ request.updated | moment( 'lll' ) }}</small>\n        </div>\n        <p class=\"mb-1 text-muted\">\n           作品集『<a :href=\"request.permalink\">{{request.post_title}}</a>』に {{request.name}}さんが（{{request.label}}）として招待されています。\n           <span v-if=\"approved\">報酬は <strong>{{ revenue }}%</strong> です。</span>\n           <span v-else>まだこの招待を受け付けていません。</span>\n        </p>\n        <p class=\"text-muted text-right\">\n            <small class=\"badge badge-light\">アクション</smallc>\n        </p>\n        <p class=\"text-right hametuha-request-actions\">\n            <button v-for=\"btn in actions\" :class=\"btn.className\" :key=\"btn.method\" @click=\"handleClick( btn.method )\">\n                {{ btn.label }}\n            </button>\n        </p>\n    </li>\n  `,\n  props: {\n    type: {\n      type: String,\n      default: '',\n    },\n    request: {\n      type: Object,\n      default: {},\n    },\n  },\n  computed: {\n    approved: function() {\n      return this.request.ratio >= 0;\n    },\n    revenue: function() {\n      return parseInt( this.request.ratio, 10 );\n    },\n    actions: function() {\n      const btn = [];\n      if ( ! this.approved ) {\n        btn.push({\n          label: '承諾する',\n          method: 'approve',\n          className: 'btn btn-success btn-sm',\n        });\n      }\n      btn.push( {\n        label: '辞退する',\n        method: 'delete',\n        className: 'btn btn-danger btn-sm',\n      } );\n      return btn;\n    }\n  },\n  mounted: function() {\n\n  },\n  methods: {\n    handleClick: function( method ) {\n      switch ( method ) {\n        case 'approve':\n          this.$emit( 'request-approved', this.request.id, this.request.post_id );\n          break;\n        case 'delete':\n          if ( window.confirm( '辞退してもよろしいですか？　この操作は取り消せません。' ) ) {\n            this.$emit( 'request-denied', this.request.id, this.request.post_id );\n          }\n          break;\n        default:\n          console && console.log( `Undefined method '${method}' is invoked.` );\n          break;\n      }\n    }\n  }\n});\n\nnew Vue( {\n\n  el: '#hametuha-requests',\n\n  template: `\n    <div class=\"hametuha-hb-request-list\" data-loading-wrapper=\"true\" style=\"position: relative;\">\n      <div v-if=\"total\">\n        <p class=\"text-muted text-right\">{{curPage}} / {{total}}ページ</p>\n      </div>\n      <ul v-if=\"requests.length\" class=\"notification-loop-container list-group\">\n        <hametuha-request class=\"notification-loop\" v-for=\"request in requests\" :request=\"request\" :type=\"type\" @request-approved=\"approvedHandler\" @request-denied=\"deniedHandler\"></hametuha-request>\n      </ul>\n      <div v-else-if=\"!loading\" class=\"alert alert-secondary\">\n        <p>リクエストはありません。</p>\n      </div>\n      <hb-pagination v-if=\"total > 1\" :total=\"total\" :current=\"curPage\" @pageChanged=\"pagination\"></hb-pagination>\n      <hb-loading :loading=\"loading\" title=\"読み込み中……\"></hb-loading>\n    </div>`,\n\n  data: {\n    type: '',\n    curPage: 1,\n    total: 0,\n    loading: false,\n    requests: []\n  },\n\n  props: {\n    type: {\n      type: String,\n      required: true\n    }\n  },\n\n  beforeMount: function () {\n    this.type = this.$el.getAttribute('data-type');\n  },\n\n  mounted: function () {\n    this.fetch( 1 );\n  },\n\n  methods: {\n    fetch: function( page ) {\n      this.loading = true;\n      wp.apiFetch( {\n        path: `/hametuha/v1/collaborators/invitations/me?paged=${page}`,\n        parse: false,\n      }).then( res => {\n        this.curPage = page;\n        this.total   = res.headers.get( 'X-WP-Total-Pages' );\n        return res.json();\n      }).then( res => {\n        this.requests = res;\n      }).catch( res => {\n        res.json().then( json => {\n          $.hbErrorMessage( json.message );\n        }).catch( res => {\n          $.hbErrorMessage( 'エラーが発生しました。' );\n        });\n      }).finally( () => {\n        this.loading = false;\n      });\n    },\n\n    pagination: function( number ) {\n      this.fetch( number );\n    },\n\n    approvedHandler( userId, postId ) {\n      this.loading = true;\n      wp.apiFetch( {\n        path: 'hametuha/v1/collaborators/invitations/me',\n        method: 'POST',\n        data: {\n          series_id: postId,\n        }\n      } ).then( res => {\n        $.hbMessage( res.message, 'success' );\n        this.fetch( this.curPage );\n      }).catch( res => {\n        let message = 'エラーが発生しました。';\n        if ( res.message ) {\n          message += res.message;\n        }\n        $.hbErrorMessage( message );\n      }).finally( res => {\n        this.loading = false;\n      });\n    },\n\n    deniedHandler( userId, postId ) {\n      this.loading = true;\n      wp.apiFetch( {\n        path: 'hametuha/v1/collaborators/invitations/me',\n        method: 'DELETE',\n        data: {\n          series_id: postId,\n        }\n      } ).then( res => {\n        $.hbMessage( res.message, 'success' );\n        this.fetch( this.curPage );\n      }).catch( res => {\n        let message = 'エラーが発生しました。';\n        if ( res.message ) {\n          message += res.message;\n        }\n        $.hbErrorMessage( message );\n      }).finally( res => {\n        this.loading = false;\n      });\n    }\n\n  }\n});\n"],"sourceRoot":""}