/*!
 * wpdeps=hashboard,hb-components-bar-chart,hb-components-pagination,hb-components-month-selector,hb-filters-moment
 */
!function(f){"use strict";var a=function(e){return"¥"+(e=parseInt(e,10)).toString().replace(/([0-9]+?)(?=(?:[0-9]{3})+$)/g,"$1,")};Vue.filter("monetize",a),Vue.filter("currency",function(e,t){var a,r=e.split("."),n=parseInt(r).toString().replace(/([0-9]+?)(?=(?:[0-9]{3})+$)/g,"$1,"),s=!1;switch(t){case"USD":a="$",s=!0;break;case"GBP":a="£",s=!0;break;case"EUR":a="€",s=!0;break;case"JPY":default:a="¥"}return s&&(n+="."+r[1]),a+n});var r=function(e){switch(e){case"KENP":return"P";default:return"部"}};Vue.filter("addSuffix",function(e,t){return e+r(t)});var e,t,p=function(e){switch(e){case"Amazon":return"KDP";default:return e}};Vue.filter("labeling",p),e=location.hash.match(/month=(\d{2})/)?("0"+RegExp.$1).slice(-2):("0"+((new Date).getMonth()+1)).slice(-2),t=location.hash.match(/year=(\d{4})/)?RegExp.$1:(new Date).getFullYear();new Vue({el:"#sales-container",data:{loading:!0,total:0,tax:0,available:!1,currentYear:t,currentMonth:e,records:[],options:{responsive:!0,maintainAspectRatio:!1,scales:{yAxes:[{id:"y-axis-price",type:"linear",position:"left"},{id:"y-axis-copy",type:"linear",position:"right"},{id:"y-axis-page",type:"linear",position:"right"}]},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(e,t){return e.datasetIndex?e.yLabel+r(t.datasets[e.datasetIndex].label):a(e.yLabel)}}}},chartData:{}},computed:{endpoint:function(){return f("#sales-container").attr("data-endpoint")},curMonth:function(){return parseInt(this.curMonth,10)},curYear:function(){return parseInt(this.curYear,10)}},methods:{errorHandler:function(){return function(e){var t="データの取得ができませんでした。";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),Hashboard.toast('<i class="material-icons error">close</i>'+t,4e3)}},fillDate:function(e,t,a,r){if(!e){e=[];for(var n=0;n<r;n++)e.push(0)}return e[t]+=a,e},exchange:function(e,t){var a;switch(t){case"JPY":a=1;break;case"GBP":a=150;break;case"EUR":a=130;break;default:a=100}return e*a},getSales:function(u,d){var h=this;this.loading=!0,f.hbRest("GET",this.endpoint,{year:u,month:d}).done(function(e){h.total=e.total,h.records=e.records;var t={};if(e.records.length){for(var a=[],n=[31,u%4==0&&u%100!=0?29:28,31,30,31,30,31,31,30,31,30,31][parseInt(d,10)-1],s=null,i={},r=1;r<=n;r++)a.push(r);f.each(e.records,function(e,t){var a=p(t.store),r=parseInt(t.date.replace(/^\d{4}-\d{2}-/,""),10)-1;s=h.fillDate(s,r,h.exchange(parseFloat(t.royalty),t.currency),n),i[a]=h.fillDate(i[a],r,parseInt(t.unit,10),n)}),t.labels=a,t.datasets=[{type:"line",label:"売上高",yAxisID:"y-axis-price",data:s,backgroundColor:"rgba(248,121,121,1)",borderColor:"rgba(248,121,121,.6)",fill:!1}];var o=["#039BE5","#388E3C","#7B1FA2","#F57C00","#0097A7","#455A64"],c=0;for(var l in i)i.hasOwnProperty(l)&&(t.datasets.push({type:"bar",label:l,yAxisID:"KENP"===l?"y-axis-page":"y-axis-copy",data:i[l],backgroundColor:o[c]}),c++);h.chartData=t}else h.chartData=t}).fail(f.hbRestError()).always(function(){h.loading=!1})},getReward:function(e,t,a){var r=this;this.loading=!0,f.hbRest("GET",this.endpoint,{year:e,month:t,status:void 0===a?"all":a}).done(function(e){r.total=e.total,r.tax=e.deducting,r.available=e.enough,r.records=e.records}).fail(f.hbRestError()).always(function(){r.loading=!1})},getPayments:function(){var t=this;this.loading=!0,f.hbRest("GET",this.endpoint,{year:this.currentYear}).done(function(e){t.total=e.total,t.tax=e.deducting,t.records=e.records}).fail(f.hbRestError()).always(function(){t.loading=!1})}},mounted:function(){new Date;switch(f("#sales-container").attr("data-slug")){case"rewards":this.getReward(this.currentYear,this.currentMonth,1);break;case"deposit":this.getReward("0000",0,0);break;case"payments":this.getPayments();break;case"history":this.getSales(this.currentYear,this.currentMonth)}}})}(jQuery);
//# sourceMappingURL=../map/hashboard/payment-table.js.map
