/*!
 * wpdeps=hashboard,hb-components-bar-chart,hb-components-pagination,hb-components-month-selector,hb-filters-moment
 */
!function(e){"use strict";var t=function(e){return e=parseInt(e,10),"¥"+e.toString().replace(/([0-9]+?)(?=(?:[0-9]{3})+$)/g,"$1,")};Vue.filter("monetize",t),Vue.filter("currency",function(e,t){var a,r=e.split("."),n=parseInt(r).toString().replace(/([0-9]+?)(?=(?:[0-9]{3})+$)/g,"$1,"),s=!1;switch(t){case"USD":a="$",s=!0;break;case"GBP":a="£",s=!0;break;case"EUR":a="€",s=!0;break;case"JPY":default:a="¥"}return s&&(n+="."+r[1]),a+n});var a=function(e){switch(e){case"KENP":return"P";default:return"部"}};Vue.filter("addSuffix",function(e,t){return e+a(t)});var r=function(e){switch(e){case"Amazon":return"KDP";default:return e}};Vue.filter("labeling",r);var n,s;n=location.hash.match(/month=(\d{2})/)?("0"+RegExp.$1).slice(-2):("0"+((new Date).getMonth()+1)).slice(-2),s=location.hash.match(/year=(\d{4})/)?RegExp.$1:(new Date).getFullYear();new Vue({el:"#sales-container",data:{loading:!0,total:0,tax:0,available:!1,currentYear:s,currentMonth:n,records:[],options:{responsive:!0,maintainAspectRatio:!1,scales:{yAxes:[{id:"y-axis-price",type:"linear",position:"left"},{id:"y-axis-copy",type:"linear",position:"right"},{id:"y-axis-page",type:"linear",position:"right"}]},tooltips:{enabled:!0,mode:"single",callbacks:{label:function(e,r){return e.datasetIndex?e.yLabel+a(r.datasets[e.datasetIndex].label):t(e.yLabel)}}}},chartData:{}},computed:{endpoint:function(){return e("#sales-container").attr("data-endpoint")},curMonth:function(){return parseInt(this.curMonth,10)},curYear:function(){return parseInt(this.curYear,10)}},methods:{errorHandler:function(){return function(e){var t="データの取得ができませんでした。";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),Hashboard.toast('<i class="material-icons error">close</i>'+t,4e3)}},fillDate:function(e,t,a,r){if(!e){e=[];for(var n=0;n<r;n++)e.push(0)}return e[t]+=a,e},exchange:function(e,t){var a;switch(t){case"JPY":a=1;break;case"GBP":a=150;break;case"EUR":a=130;break;default:a=100}return e*a},getSales:function(t,a){var n=this;this.loading=!0,e.hbRest("GET",this.endpoint,{year:t,month:a}).done(function(s){n.total=s.total,n.records=s.records;var i={};if(!s.records.length)return void(n.chartData=i);for(var o=[],c=[31,t%4===0&&t%100!==0?29:28,31,30,31,30,31,31,30,31,30,31][parseInt(a,10)-1],l=null,u={},d=1;d<=c;d++)o.push(d);e.each(s.records,function(e,t){var a=r(t.store),s=parseInt(t.date.replace(/^\d{4}-\d{2}-/,""),10)-1;l=n.fillDate(l,s,n.exchange(parseFloat(t.royalty),t.currency),c),u[a]=n.fillDate(u[a],s,parseInt(t.unit,10),c)}),i.labels=o,i.datasets=[{type:"line",label:"売上高",yAxisID:"y-axis-price",data:l,backgroundColor:"rgba(248,121,121,1)",borderColor:"rgba(248,121,121,.6)",fill:!1}];var h=["#039BE5","#388E3C","#7B1FA2","#F57C00","#0097A7","#455A64"],f=0;for(var p in u)u.hasOwnProperty(p)&&(i.datasets.push({type:"bar",label:p,yAxisID:"KENP"===p?"y-axis-page":"y-axis-copy",data:u[p],backgroundColor:h[f]}),f++);n.chartData=i}).fail(e.hbRestError()).always(function(){n.loading=!1})},getReward:function(t,a,r){var n=this;this.loading=!0,e.hbRest("GET",this.endpoint,{year:t,month:a,status:"undefined"==typeof r?"all":r}).done(function(e){n.total=e.total,n.tax=e.deducting,n.available=e.enough,n.records=e.records}).fail(e.hbRestError()).always(function(){n.loading=!1})},getPayments:function(){var t=this;this.loading=!0,e.hbRest("GET",this.endpoint,{year:this.currentYear}).done(function(e){t.total=e.total,t.tax=e.deducting,t.records=e.records}).fail(e.hbRestError()).always(function(){t.loading=!1})}},mounted:function(){new Date;switch(e("#sales-container").attr("data-slug")){case"rewards":this.getReward(this.currentYear,this.currentMonth,1);break;case"deposit":this.getReward("0000",0,0);break;case"payments":this.getPayments();break;case"history":this.getSales(this.currentYear,this.currentMonth)}}})}(jQuery);
//# sourceMappingURL=../map/hashboard/payment-table.js.map
